---
slug: pachama
title: "How Pachama creates maps on the fly with Fused"
authors: [andrew]
tags: [tiles, pachama]
unlisted: true
image: https://i.imgur.com/mErPwqL.png
hide_table_of_contents: false
---




Pachama is a startup with a mission to harness satellite data and AI to empower companies to confidently invest in nature. Pachama's Land Suitability Tool helps landowners and project developers identify ideal parcels of land to implement carbon projects.


import ReactPlayer from 'react-player'

<ReactPlayer className="video__player" playing={true} muted={true} controls height="100%" url="https://fused-magic.s3.us-west-2.amazonaws.com/blog-assets/pachama_land_suitability_app.mp4" width="100%" />



## The Challenge: Harness satellite data to quickly assess potential forest restoration projects

Pachama harnesses earth observation data and AI to bring unprecedented insight into how forests sequester carbon, protect wildlife and benefit local communities. By harnessing the latest advancements in technology, they bring transparency and integrity to forest restoration projects, catalyzing funding in natural climate solutions.


Pachama recently built the Land Suitability Tool within their Project Partner Portal which revolutionizes how project developers can rapidly assess the restoration potential of prospect project sites. In this portal, organizations and landowners looking to start a reforestation project can draw or upload a polygon to define an Area Of Interest (AOI), then quickly estimate its eligibility to develop restoration projects based on layers derived from environment models. For example, a project may derive credits from carbon sequestration through native reforestation and ally with local communities that earn an income as stewards of the land. To generate these assessments, Pachama’s science team factors in country-level data about land cover, vegetation history, and natural risks.




> “Fused has been critical in our product lifecycle. The speed at which we were able to iterate based on new requirements is unrivaled. ”
>
> Andrew Campbell, Senior Software Engineer @ Pachama


Pachama's challenge was to create a map app to quickly show forest restoration potential for custom user-defined AOIs. Their standard approach would have involved running complex ETL pipelines over country-wide areas, ingesting into a tile server, and then serving tiles for the map to consume.

In their first approach, their data needed to be ingested and converted into analytical formats like Zarr and GeoTIFF files. Then, an ETL process would vectorize the Zarr files, store them in a cloud bucket, and convert the vector data to tilesets using a map API services tool.. Although the Global Forest Watch data is global, Pachama only needed national-level support. Additionally, since the app users define custom polygons, it was not possible to know which locations data would be needed for, necessitating the processing of the entire dataset even though most of the data would never be used. With pricing based on areas processed in square kilometers (and related storage), the process was quite costly for their needs.

Furthermore, Pachama needed to bridge the gap between geospatial data in analytical and visualization formats to provide users with a good UX when interacting with the map. The flow of data from the science team to the end-users involved a complex handoff across data engineers and the frontend team, resulting in workflows with complex infrastructure, long-running jobs, and slow turn-around times.
The solution: Fused’s serverless tile generation

To address the challenge of enabling users to quickly run analysis on custom AOIs, Pachama turned to Fused’s Hosted API to generate maps with serverless API endpoints. Fused now provides them with an elegant way to crunch data with Python and serve it behind endpoints that natively integrate with map tile layers. This makes it possible to process and visualize any size datasets and curbs their operation costs.

With Fused, Pachama replaced a complex pre-processing pipeline with a single User-Defined Function (UDF) that directly loads data to the frontend. By dynamically generating tiles from the analytical data based on user requests, Pachama can provide national-level coverage without processing unnecessary data, streamlining their workflow and enabling more efficient and cost-effective operations.

import ImageA from '/blog/2024-08-25-pachama/pachama_pipelinea.png';

<div style={{textAlign: 'center'}}>
<img src={ImageA} alt="File" style={{}} />
</div>

## Key Benefits

- Dynamic Tile Generation: Eliminates pre-computation, reducing complexity and costs. Tiles are generated on-the-fly based on user-defined AOIs.
- Simplified Workflows: Single UDF replaces steps of preprocessing pipelines. UDFs run in parallel for each request, working directly with raw, cloud-native data.
- Scalable Solution: Enables national-level coverage without processing unnecessary data.
- Cost-Effective: Significantly reduces operational costs.


The ability to trigger a UDF that generates a vector directly from a ZAR file was a game-changer for Pachama’s ability to close the gap between their analytics and their end-users. This innovation has made the team more productive and enabled them to streamline complex tasks that were previously cumbersome and impractical.

> “Fused takes DevOps out of our hands to focus on our core mission, building technology to restore nature.”
>
> Marie,
> Staff Software Engineer @ Pachama

import ImageB from '/blog/2024-08-25-pachama/pachama_pipelineb.png';

<div style={{textAlign: 'center'}}>
<img src={ImageA} alt="File" style={{}} />
</div>

Pachama's Land Suitability tool covers national-level data for the contiguous USA, Brazil, and Mexico, with plans to expand to more regions around the world. It processes a variety of datasets including Pachama's proprietary canopy height map. Pachama generates regional maps of average top-of-canopy height using a combination of lidar from GEDI and a suite of satellite observations at varying spatial scales, including optical and radar imagery, topography, and climate data. Fused’s on-the-fly tiling simplifies the data architecture to generate and load the data into the user-facing app.

By combining analytical and visualization capabilities, Fused enables powerful and productive workflows. Instead of pre-computing tiles for entire datasets, Pachama now generates tiles dynamically only for user-defined AOIs, reducing system complexity and cost.

Here’s a simplified example of how Pachama uses a Fused User Defined Function (UDF) to generate a vector from a raster file in COG format:


```python
@fused.udf
def udf(bbox: fused.types.TileGDF=None):
    import geopandas as gpd
    utils = fused.load("https://github.com/fusedio/udfs/tree/main/public/common/").utils

    table_path = "s3://pachama-fused-data/dataset.tiff"

    # Todo: raster to vector
    …
    return gdf
```



The Fused Hosted API service automatically provisions an endpoint for each of Pachama’s UDFs. The prospecting application then loads the endpoint into a mapbox mapping application, which consumes the output in MVT format as defined by the `dtype_out_vector` parameter.


## Key Features
- Endpoints templatized to work with slippy maps - which is standard across map tiling applications.
- Map clients call the endpoint for each tile in the viewport, passing values for z, x, and y. Fused then runs the UDF, passing a GeoDataframe with the Tile coordinates.
- The UDF code spatially filters the referenced dataset, processes the fraction of data, and returns it to the client app as the response of the HTTP call in the format specified via a query parameter. This avoids the need to pre-compute data or manage files.


Example endpoint call
```bash
https://www.fused.io/server/v1/realtime-shared/public-token/run/tiles/{z}/{x}/{y}?dtype_out_vector=mvt
```

## The Result: Simplify data workflows by 50% and increase engineering productivity
“Fused and its UDF environment revolutionize tile-based map rendering by leveraging analytical tools: cloud-optimized data formats, flexibility of python spatial, scalability of serverless. This is where we see the most value in Fused: There used to be a gap between the analytical data formats (e.g. COGs & geoparquets) and visualization data formats (MVT, PMTiles, XYZ Tiles). Fused closed the gap and let us retire a major piece of the pipeline.”

> “Fused replaced 4 steps of the pipeline with a single Fused UDF”
>
> Andrew Campbell, Senior Software Engineer @ Pachama






Figure: new workflow with Fused







(placeholder) Figure: previous ETL process. Fused UDF replaces steps 4-7.



## Future innovation for Pachama
Looking ahead, Pachama aims to expand this powerful tool around the world, catalyzing high-integrity reforestation projects in the regions that need it the most. With Fused’s infrastructure underpinning their platform, Pachama can stay focused on their core mission to make powerful science and analytics accessible to everyone through intuitive visual interfaces.


Visit the following pages to learn more about Pachama’s mission and technology to scale high-integrity reforestation projects.
