---
slug: rainfall-similarity-global
title: "Finding Twin Locations based on Rainfall Patterns"
authors: [milind]
tags: [weather, similarity, rainfall]
unlisted: true
# image:
hide_table_of_contents: false
keywords: [Similarity]
---

This article explores a User Defined Function (UDF) that utilizes global precipitation data to compare rainfall patterns between different locations worldwide and then create an interactive app as well!

import ImageSim from "/blog/2024-09-11-milindsoni/simmap.png";

<div style={{ textAlign: "center" }}>
  <img src={ImageSim} alt="File" style={{}} />
</div>

## Introduction

While we focus on rainfall, the approach that I am about to tell can be applied to various parameters, potentially transforming fields from climate research to investment strategies. The UDF uses precipitation data and geospatial techniques to compare monthly rainfall averages globally, demonstrating how data analysis can uncover connections between distant locations.
Let's dive into how this UDF works and its potential applications.

## How It Works

Our UDF utilizes the following key components:

1. Earth Engine API: To fetch global precipitation data
2. H3 Index: For efficient spatial indexing
3. DuckDB :
4. Cosine Similarity: To compare rainfall vectors

## Getting the Data

The data retrieval process is streamlined using Fused and Xarray:

1. **Fused and Earth Engine**: Fused simplifies access to Google Earth Engine's vast catalog. It provides a more intuitive and faster interface with a much better file manager for working with spatial data compared to Earth Engine platform itself.

2. **Xarray Integration**: We use Xarray to work with our multi-dimensional rainfall data. It allows for easy handling of labeled arrays and datasets, particularly useful for time-series climate data.

import xarray from "/blog/2024-09-11-milindsoni/xarray.png";

<div style={{ textAlign: "center" }}>
  <img src={xarray} alt="File" style={{}} />
</div>

3. **Data Aggregation with DuckDB**: After retrieving the raw data, we use DuckDB to efficiently aggregate it. This involves:

   - Grouping the data by H3 hexagon and month
   - Calculating average monthly rainfall for each hexagon
   - Creating 12-element vectors representing annual rainfall patterns for each location

import Vector from "/blog/2024-09-11-milindsoni/h3vector.png";

<div style={{ textAlign: "center" }}>
  <img src={Vector} alt="File" style={{}} />
</div>

4. **Cosine Similarity Calculation**: Finally, we use cosine similarity to compare these rainfall vectors. This allows us to quantify how similar the rainfall pattern of one location is to another, or to a reference pattern.

import CosineSim from "/blog/2024-09-11-milindsoni/cosinesim.png";

<div style={{ textAlign: "center" }}>
  <img src={CosineSim} alt="File" style={{}} />
</div>
