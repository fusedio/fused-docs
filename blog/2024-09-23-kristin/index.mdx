---
slug: the-strength-in-weak-data
title: "The Strength in Weak Data: Part 1"
authors: [kristin]
tags: [crop,yield,agriculture]
unlisted: true
# image: https://fused-magic.s3.us-west-2.amazonaws.com/blog-assets/social_jennings.png
hide_table_of_contents: false
keywords: [crop,yield,agriculture]
---

Ever tried to make sense of the myriad file types in spatial data science and felt like you've wandered into a linguistic labyrinth? Trust me, you're not alone.

As a data scientist who's spent more time wrangling datasets than I care to admit, I thought I'd take a casual stroll down memory lane with an old high school friend: regression models. Just a simple plot of actual vs. predicted, right? But when spatial data's involved, you can't just sit back and relax—you've got to keep one eye on the geometries.

Here is the lineup:

import Image1 from '/blog/2024-09-23-kristin/kr1.png';

<div style={{textAlign: 'center'}}>
<img src={Image1} alt="File" style={{}} />
</div>

The resolution differences are huge—going from 30 square meters up to 5 billion! Traditional tools would have you pulling your hair out, but Fused lets you turn this “weak” data into something powerful.

## Actual Variable

When dealing with mismatched data at this scale, you've got to align it to the coarsest resolution—in this case, the county level.

So, let's dive in. I grabbed a CSV of county ANSI codes and my actual variable. And thanks to Fused's [File Explorer](/workbench/file-explorer/), rendering it on a map it was a breeze. I just popped over to the S3 bucket with the dataset, double-clicked the file, and—like magic—the entire map rendered instantly.

import Image2 from '/blog/2024-09-23-kristin/kr2.png';

<div style={{textAlign: 'center'}}>
<img src={Image2} alt="File" style={{}} />
</div>

Remember the days of wrestling with shapefile resolutions? No more. I edited the UDF to pull my actual data CSV straight from my S3 bucket in under 30 seconds. Boom.


## Predictor Variable

Now, here's where it gets spicy. Our predictor is a NetCDF file from 5 degrees off the equator (around 25 km²). NetCDFs have this habit of being finicky, but but I tapped into Fused's [utility modules](/python-sdk/top-level-functions/#utils). I used them to clip the array, convert it into an image, and add a colormap.

```python showLineNumber
@fused.udf
def udf(bbox, path: str='s3://fused-users/fused/sina/Kristin/sif_ann_201409a.nc'):
    xy_cols=['lon','lat']
    # Get the data array using the constructed path
    da = fused.utils.common.get_da(path, coarsen_factor=3, variable_index=0, xy_cols=xy_cols)
    # Clip the array based on the bounding box
    arr_aoi = fused.utils.common.clip_arr(da.values,
                       bounds_aoi=bbox.total_bounds,
                       bounds_total=fused.utils.common.get_da_bounds(da, xy_cols=xy_cols))
    # Convert the array to an image with the specified colormap
    img = (arr_aoi*255).astype('uint8')
    return fused.utils.common.arr_to_plasma(arr_aoi, min_max=(0, 1), colormap="rainbow", include_opacity=False, reverse=True)
```

Once I published the UDF, I visualized the data in the Fused App Builder.

import Iframe from "@site/src/components/Iframe";
import BUFFER_CODE from "@site/src/app-iframe/python/kristin.py";

<Iframe
  id="iframe-1"
  code={BUFFER_CODE}
  requirements={[
    "/pyarrow/pyarrow-17.0.0-cp312-cp312-pyodide_2024_0_wasm32.whl",
    "micropip",
    "pyodide-unix-timezones", // needed by pyarrow
    "geopandas",
    "requests",
    "xarray",
    "yarl",
    // Commonly used in product:
    "streamlit-folium",
  ]}
  height={500}
/>



## Bringing It All Together

With my actual and predicted variables in sync, the next step is to bring in the secret sauce that turns weak data into strong. But for that, you'll have to hang tight for Part 2. Stay tuned…
