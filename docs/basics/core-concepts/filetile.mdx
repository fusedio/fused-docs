---
id: filetile
title: Map Tile/File
tags: [write, endpoints, api, http, file, tile]
sidebar_position: 4
toc_min_heading_level: 2
toc_max_heading_level: 4
---



# Map Tile/File  

import Tag from '@site/src/components/Tag'

### <Tag color="#D1E550" fontColor="#141414" >ðŸš§ Under Construction</Tag>


UDFs can be called via HTTP endpoints, allowing them to execute and return results. UDFs can be called in two modes: `File` and `Tile`.

### Map File

In `File` mode, the UDF processes and returns data within a single HTTP response. This is ideal for smaller datasets where entire processing can be efficiently handled in one request.

### Map Tile

`Tile` mode is designed to work with geospatial datasets. The UDF processes data in grid-based tiles that conform to [web map tiling schemas](https://wiki.openstreetmap.org/wiki/Slippy_map). Each Tile call may correspond to a manageable spatial segment of a larger dataset.

When and endpoint is called as a `Tile`, Fused passes `bbox` as the first argument, which the UDF can use to spatially filter the dataset. The `bbox` contains spatial information that defines the corresponding Tile. 

import ImageTile from '/img/image-tile2.png';


<div style={{textAlign: 'center'}}>
<img src={ImageTile} alt="File" style={{width: 600}} />
</div>

This is in contrast with a `File` call, where a single call handles all the data.

import ImageFile from '/img/image-file2.png';

<div style={{textAlign: 'center'}}>
<img src={ImageFile} alt="File" style={{width: 600,}} />
</div>


## The `bbox` object

A UDF may use the `bbox` parameter to spatially filter a dataset. It enables UDFs to efficiently access datasets in [cloud-optimized data formats](https://guide.cloudnativegeo.org/), which reduces latency and data transfer costs. 

Tile-level spatial filtering supercharges UDFs to process only specific parts of a dataset - based on specified geographic or logical partitions.

:::tip
The growing popularity of cloud optimized data formats is revolutionizing data processing by eliminating the need for specialized hardware to handle large datasets. For further reading on data formats, refer to resources on: [Cloud Optimized GeoTiff](https://www.cogeo.org/), [Geoparquet](https://geoparquet.org/), and [GeoArrow](https://geoarrow.org/format.html).
:::

Consequently, Tiled web map clients can call Fused endpoints and dynamically pass a ZXY index for each Tile to render. When a UDF endpoint is called this way - in Tile mode - Fused passes the UDF a `bbox` object as the first parameter. This object is a data structure with information that corresponds to the Tile's bounds and/or XYZ coordinates. The object is named `bbox` by convention, but it's possible to use a different name __as long as it's in the first parameter__.

:::tip

If the UDF is called as a File, Fused does not pass a `bbox` parameter. To write UDFs so they can be called in either execution mode, Fused recommends setting the `bbox` as the first parameter, and typing it as a `fused.types.Bbox` with a default value of `None`. This will enable the UDF to run in both as `File` (when `bbox` isnâ€™t necessarily passed) and as a `Tile`. For example:

```python
@fused.udf
def udf(bbox: fused.types.Bbox=None):
    ...
    return ...
```

When using the Fused Workbench, a UDF can be configured to render as "Auto" so Workbench automatically handles the output as `Tile` if it statically checks that the above types are used in the UDF. Otherwise, it assumes File.

UDFs called via the Fused Python SDK or HTTP requests run as Tile only if a parameter specifies the `Tile` geometry. 
:::

### `bbox` object types
:::tip
Read more about [supported types for UDF parameters](/python-sdk/#typing). 
:::
For convenience, users can configure the Python type of the `bbox` object. The 3 available types for the `bbox` object are:

#### `fused.types.TileGDF` 
This is a [geopandas.geodataframe.GeoDataFrame](https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.html) with `x`, `y`, `z`, and `geometry` columns.

```python
@fused.udf
def udf(bbox: fused.types.TileGDF=None):
    print(bbox)
    return bbox

>>>      x    y   z                                           geometry
>>> 0  327  790  11  POLYGON ((-122.0 37.0, -122.0 37.1, -122.1 37.1, -122.1 37.0, -122.0 37.0))
```

#### `fused.types.Bbox` 
This is a [shapely.geometry.polygon.Polygon](https://shapely.readthedocs.io/en/stable/reference/shapely.Polygon.html) corresponding to the Tile's bounds.

```python
@fused.udf
def udf(bbox: fused.types.Bbox=None):
    print(bbox)
    return bbox

>>> POLYGON ((-122.0 37.0, -122.0 37.1, -122.1 37.1, -122.1 37.0, -122.0 37.0))
```


#### `fused.types.TileXYZ` 
This is a [mercantile.Tile](https://mercantile.readthedocs.io/en/stable/api/mercantile.html) object with values for the `x`, `y`, and `z` Tile indices.

```python
@fused.udf
def udf(bbox: fused.types.TileXYZ=None):
    print(bbox)
    return bbox

>>> Tile(x=328, y=790, z=11)
```







## Call HTTP endpoints
### File endpoint

By default, a UDF runs as `File` - it executes once and returns a single output that corresponds to the input parameters. The UDF endpoint behaves like a remote file in that calling it returns a single batch of data - but the endpoint also accepts parameters that dynamically influence the UDF's execution. 

```bash
https://www.fused.io/server/.../run/file?dtype_out_vector=csv
```

This enables client applications to make an HTTP request and load the UDF's output data into the tool that makes the call.

:::tip
Note that files are downloaded entirely - even if the data is requested as a Parquet.
:::

### Tile endpoint

The same UDF's API endpoint can be called to run like a `Tile`. This makes it possible for Fused to serve vector or raster tiles into industry standard tools that work with [tiled web maps](https://en.wikipedia.org/wiki/Tiled_web_map) - think Leaflet, Mapbox, Foursquare Studio, Lonboard, and beyond. 

```bash
https://www.fused.io/server/.../run/tiles/{z}/{x}/{y}?&dtype_out_vector=csv
```


Tiled web map clients can make dozens of simultaneous calls to the Fused API endpoint - one for each tile - and seamlessly stitch the outputs to render a map. Instead of operating on an entire dataset, Fused only acts on the data that corresponds to the area visible in the current viewport.

