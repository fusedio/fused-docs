---
id: filetile
title: Map Tile/File
tags: [write, endpoints, api, http, file, tile]
sidebar_position: 4
toc_min_heading_level: 2
toc_max_heading_level: 4
---



# Map Tile/File  

import Tag from '@site/src/components/Tag'

### <Tag color="#D1E550" fontColor="#141414" >ðŸš§ Under Construction</Tag>


UDFs can be called to [run](/basics/core-concepts/run/) and return results. They support two operation modes: `File` and `Tile`.

### Map File

In `File` mode, the UDF endpoint handles data processing within a single HTTP response. This is suitable for datasets small enough to fit in memory and processes that can be completed in one request.

### Map Tile

`Tile` mode is optimized for geospatial datasets. In this mode, the UDF endpoint processes data in grid-based tiles that align with [web map tiling schemas](https://wiki.openstreetmap.org/wiki/Slippy_map). Each Tile request may correspond to a spatial slice of a larger dataset, making it ideal to work with large datasets that can be spatially filtered. 

When a UDF endpoint is called as `Tile`, Fused passes `bbox` as the first argument, which the UDF can use to spatially filter the dataset. The [`bbox` object](/basics/core-concepts/filetile/#bbox-object-types) contains spatial information, such as the Tile's bounds or XYZ index, that defines the corresponding Tile. 

import ImageTile from '@site/static/img/image-tile2.png';


<div style={{textAlign: 'center'}}>
<img src={ImageTile} alt="File" style={{width: 600}} />
</div>

This is in contrast with a `File` call, where a single request processes and returns the complete output within a single HTTP response. In `File` mode, the UDF doesn't receive a `bbox` object and doesn't segment the data into tiles. 

import ImageFile from '@site/static/img/image-file2.png';

<div style={{textAlign: 'center'}}>
<img src={ImageFile} alt="File" style={{width: 600,}} />
</div>


## The `bbox` object


A UDF may use the `bbox` parameter to operate on spatial areas defined by the Tile's bounds. This functionality lets Tiled web map clients call Fused endpoints and dynamically define which Tile to render. 

:::tip

A UDF may use the `bbox` parameter to spatially filter a [cloud-optimized dataset](https://guide.cloudnativegeo.org/), which reduces latency and data transfer costs. In these cases, the UDF spatially filters the dataset and loads into memory only the data that falls within the Tile's bounds.

Common cloud-optimized formats are: [Cloud Optimized GeoTiff](https://www.cogeo.org/), [Geoparquet](https://geoparquet.org/), and [GeoArrow](https://geoarrow.org/format.html).
:::




### `bbox` object types

The `bbox` object defines the spatial bounds of the Tile, which can be represented as a geometry object or XYZ index. To accomodate different use cases, a user writing a UDF can choose from 3 `bbox` object structures by specifying a type.

#### `fused.types.TileGDF` 
This is a [geopandas.geodataframe.GeoDataFrame](https://geopandas.org/en/stable/docs/reference/api/geopandas.GeoDataFrame.html) with `x`, `y`, `z`, and `geometry` columns. This is the default structure if no type is set.

```python
@fused.udf
def udf(bbox: fused.types.TileGDF=None):
    print(bbox)
    return bbox

>>>      x    y   z                                           geometry
>>> 0  327  790  11  POLYGON ((-122.0 37.0, -122.0 37.1, -122.1 37.1, -122.1 37.0, -122.0 37.0))
```

#### `fused.types.Bbox` 
This is a [shapely.geometry.polygon.Polygon](https://shapely.readthedocs.io/en/stable/reference/shapely.Polygon.html) corresponding to the Tile's bounds.

```python
@fused.udf
def udf(bbox: fused.types.Bbox=None):
    print(bbox)
    return bbox

>>> POLYGON ((-122.0 37.0, -122.0 37.1, -122.1 37.1, -122.1 37.0, -122.0 37.0))
```


#### `fused.types.TileXYZ` 
This is a [mercantile.Tile](https://mercantile.readthedocs.io/en/stable/api/mercantile.html) object with values for the `x`, `y`, and `z` Tile indices.

```python
@fused.udf
def udf(bbox: fused.types.TileXYZ=None):
    print(bbox)
    return bbox

>>> Tile(x=328, y=790, z=11)
```

:::tip
Read about other supported [UDF parameter types](/basics/core-concepts/write/#typed-parameters). 
:::


## Call HTTP endpoints

A UDF called via an [HTTP endpoint](/basics/core-concepts/run/#http-requests) may be invoked as `File` or `Tile`, depending on the URL structure.


### File endpoint


This endpoint structure runs a UDF as a `File`.

```bash
https://www.fused.io/server/.../run/file?dtype_out_vector=csv
```


### Tile endpoint


This endpoint structure runs a UDF as a `Tile`. The `{z}/{x}/{y}` templated path parameters correspond to the Tile's XYZ index, which Tiled web map clients dynamically populate.

```bash
https://www.fused.io/server/.../run/tiles/{z}/{x}/{y}?&dtype_out_vector=csv
```
