# Point with polygon

```python
@fused.udf
def udf(year: str = '2010', month: str = '01', n_rows: int = 10000, object_to_show='points'):
    import geopandas as gpd
    import h3
    import pandas as pd

    from utils import generate_color_from_identifier, lonlat_to_geom
    
    @fused.cache
    def load_taxi_data(year, month, n_rows=n_rows):
        return pd.read_parquet(f'https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_{year}-{month}.parquet').head(n_rows)

    @fused.cache
    def load_census_blocks(counties=["061"]):
        url="https://www2.census.gov/geo/tiger/TIGER_RD18/STATE/36_NEW_YORK/36/tl_rd22_36_bg.zip"
        gdf = gpd.read_file(url)
        gdf = gdf[gdf["COUNTYFP"].isin(counties)]
        return gdf

    # Load data
    gdf_census_blocks = load_census_blocks()
    taxi_data = load_taxi_data(year='2010', month='01')
    taxi_data['geometry'] = lonlat_to_geom(taxi_data, cols_lonlat=['pickup_longitude','pickup_latitude'])
    taxi_data = gpd.GeoDataFrame(taxi_data)

    # Spatial join between points and polygons
    joined = gpd.sjoin(taxi_data, gdf_census_blocks, how="left", op="within")
    joined[['r', 'g', 'b']] = pd.DataFrame(joined['GEOID'].apply(generate_color_from_identifier).tolist(), index=joined.index)
    return joined
```


import Iframe from '@site/src/components/Iframe';


<Iframe url="https://staging.fused.io/workbench#app/s/aH4sIAAAAAAAAA61U247aMBD9Fct9AKQsJOESQMpTq1aq%2BrDSVn0hKHLiSXAxdmqbZWm1%2F94xsCwbthepndxmzsyczIyd%2FKCl5kDnVGwabRxp9hzKNWGWNHydqRNqnQG2kcJ5h3VnvNpa4DlrmjNSg26Y4hiGZ93wTPnDur4TTkI3o7daKEeEIrda7mutMto7xmTK6TUokpJOkfBoVvJZEg%2BrOOKTURHFPK6mJY%2FYpAqHrOBJEUI8ScoiiYCzeJpwNmFxNC1ZBEUnU7xConN5fbNV3QN9QHTxFUqXO53bld6lneZYh%2B0EROVG72w6DlF6niNvfLX276l89DWRVHVAJHPI071Jhv3ZNElm44CMwn4yHo1no8MI3pC3OGUHZMOaw8iOa5GXK2ZcN1MEBRel%2Fw7Bk%2BkFo3Pr9hLSjKJe6If5YHAA7OBoDzgz65v7WUaD5zShhBNM5vcCdpiP7009%2BRc077x18QYvWL1wWw4pKkHLpVV98mGfL33ftd6kUdhCG%2BHKVXqJ9i50yfZgbLpo5WBxn7ynVZiXjH4A%2FdFqdQh40eaTcOZYyqtXPDW4vBJS5qWW2qSLeIwrE%2BM1DAMShctfpEihoJXibz4lfDUJvyHcNTz9bLbwO86d4G51PbNee4b%2FZR6nDf7nHjsLE9RBsez8c2fjq86ezae5IdSjATXwbSsMbABLpPMFPf9cTj6wzqsPzBi2R2XPjMTH8buhy4AK%2B34r5V1pABSdV0xaePwJURrND%2FIEAAA%3D"/>

