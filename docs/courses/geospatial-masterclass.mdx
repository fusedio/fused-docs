---
id: geospatial-masterclass
title: Geospatial Masterclass
sidebar_position: 1
---

# Geospatial Masterclass

Master geospatial data processing, analysis, and visualization using Fused. Learn spatial data types, coordinate systems, and advanced geospatial analytics.

## Course Overview

This comprehensive course will take you through the fundamentals of geospatial data processing and analysis using Fused. You'll learn how to work with different spatial data types, understand coordinate systems, and master advanced geospatial analytics techniques.

## What You'll Learn

- Understanding spatial data types and formats
- Working with coordinate systems and projections
- Geospatial data processing and analysis
- Advanced visualization techniques
- Real-world applications and use cases

## Prerequisites

- Basic understanding of Python
- Familiarity with data processing concepts
- No prior geospatial experience required

## Course Structure

1. Introduction to Geospatial Data
2. Coordinate Systems and Projections
3. Spatial Data Processing
4. Geospatial Analysis
5. Visualization and Mapping
6. Advanced Topics and Applications

[![Open In Workbench Collection](https://img.shields.io/badge/Open_In_Workbench_Collection-16-green?style=for-the-badge)](https://www.fused.io/workbench/catalog/Fused_Course_Module1-37ec2eb3-6481-4cb1-b406-f8e39c339a52)

## Table of Contents

- [Introduction](#introduction)
- [Prerequisites](#prerequisites)
- [Getting Started](#getting-started)
- [Module 1: Basic Spatial Operations](#module-1-basic-spatial-operations)
  - [01. Working with Points](#01-working-with-points)
    - [Exercise](#01-working-with-points-exercise)
    - [Code Examples](#01-working-with-points-code)
  - [02. Creating Buffers](#02-creating-buffers)
    - [Exercise](#02-creating-buffers-exercise)
    - [Code Examples](#02-creating-buffers-code)
  - [03. Spatial Joins](#03-spatial-joins)
    - [Exercise](#03-spatial-joins-exercise)
    - [Code Examples](#03-spatial-joins-code)
- [Module 2: Advanced Spatial Operations](#module-2-advanced-spatial-operations)
  - [01. Spatial Aggregations](#01-spatial-aggregations)
    - [Exercise](#01-spatial-aggregations-exercise)
    - [Code Examples](#01-spatial-aggregations-code)
  - [02. Spatial Indexing](#02-spatial-indexing)
    - [Exercise](#02-spatial-indexing-exercise)
    - [Code Examples](#02-spatial-indexing-code)
  - [03. Complex Spatial Queries](#03-complex-spatial-queries)
    - [Exercise](#03-complex-spatial-queries-exercise)
    - [Code Examples](#03-complex-spatial-queries-code)
  - [04. Performance Optimization](#04-performance-optimization)
    - [Exercise](#04-performance-optimization-exercise)
    - [Code Examples](#04-performance-optimization-code)

## Introduction

Welcome to the Geospatial Masterclass! This course focuses on core geospatial operations, taking you from basic spatial data handling to advanced spatial analysis techniques using Fused.

[![Open In Workbench Collection](https://img.shields.io/badge/Open_In_Workbench_Collection-16-green?style=for-the-badge)](https://www.fused.io/workbench/catalog/Fused_Course_Module1-37ec2eb3-6481-4cb1-b406-f8e39c339a52)

## Prerequisites

Before starting this course, you should have:
- Basic Python knowledge
- Understanding of data structures
- Familiarity with pandas
- Fused installed and configured

:::note
You'll need to be [logged in](/user-guide/login/) with an account to be able to follow this course.

Without having an environment you can still access [Workbench](/workbench/), [install](/python-sdk/#install) `fused` locally and [run Public UDFs](/core-concepts/run-udfs/run-small-udfs/#public-udf-name) (in Workbench & locally). You can also run any UDF you want locally with `fused.run(my_udf, engine='local')`.
:::

## Getting Started

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import ReactPlayer from 'react-player';

<Tabs className="unique-tabs">
  <TabItem value="workbench" label="In Workbench" default>

    Workbench is Fused browser-based IDE. We have a [whole detailed section](/workbench) about it, but we'll take you through the basics here.

    You can start by opening [Fused Workbench](https://www.fused.io/workbench) in another tab.

    Choose `Add UDF` and then `+ New UDF`, which will start creating a new UDF:

    Welcome to workbench! üõ†Ô∏è

    You now have access to a full Python development environment directly in your browser, where you can
    - Edit your UDFs in real time
    - See the geospatial output in the map view
    - Debug & explore data in the `Stdout` tab of the Results page

    :::info

      You can still use Workbench as a read-only user if you aren't signed-up, but to use the full benefit of workbench, [login](https://www.fused.io/workbench/preferences) or [join our waitlist](https://docs.google.com/forms/d/1NVzMjc2tXxlIgnFrxqQPM_NtG1B2AQ0En_pAbZHYSK0)

    :::

  </TabItem>
  <TabItem value="local" label="Locally">

    You can also do everything from your local machine (or anywhere else!) using `fused`. To use `fused` locally you first need to [install it](/python-sdk/#install):

    ```python showLineNumbers
    pip install fused
    ```

    :::info

    We recommend you use a virtual environment to work with `fused` and you'll need `python >=3.11`. Read more in the dedicated [Install Fused section](/python-sdk/#install)

    :::

    We recommend using [jupyter notebooks](https://jupyter.org/) as these allow you to run cell by cell and see output directly under code blocks. In a new notebook we can define our first UDF:

    ```python showLineNumbers
    @fused.udf
    def udf(message: str = "Hello World!"):
        return message
    ```

    You can now run this UDF from your notebook:
    
    ```python showLineNumbers
    msg = fused.run(udf)
    ```

    :::note
    You'll need to be [logged in](/user-guide/login/) to be able to run a UDF on our Fused server. 

    If you either don't have an account or only have a free account without any environment you can still run UDF, but locally on your device:

    ```python showLineNumbers
    msg = fused.run(udf, engine='local')
    ```
    :::

  </TabItem>
</Tabs>

## Module 1: Basic Spatial Operations

### 01. Working with Points
[![Open In Workbench Collection](https://img.shields.io/badge/Open_In_Workbench_Collection-4-green?style=for-the-badge)](https://www.fused.io/workbench/catalog/Fused_Course_Module1-37ec2eb3-6481-4cb1-b406-f8e39c339a52)

- Creating points
- Point operations
- Point attributes
- Basic spatial queries

#### Exercise
- Create points from coordinates
- Add attributes to points
- Perform basic spatial queries
- Visualize points on a map

#### Code Examples
```python
@fused.udf
def udf():
    import geopandas as gpd
    from shapely.geometry import Point
    
    # Create points
    points = [
        Point(-74.0060, 40.7128),  # New York
        Point(-118.2437, 34.0522),  # Los Angeles
        Point(-87.6298, 41.8781)   # Chicago
    ]
    
    # Create GeoDataFrame with points
    gdf = gpd.GeoDataFrame({
        'city': ['New York', 'Los Angeles', 'Chicago'],
        'geometry': points
    }, crs="EPSG:4326")
    
    return gdf
```

### 02. Creating Buffers
[![Open In Workbench Collection](https://img.shields.io/badge/Open_In_Workbench_Collection-4-green?style=for-the-badge)](https://www.fused.io/workbench/catalog/Fused_Course_Module1-37ec2eb3-6481-4cb1-b406-f8e39c339a52)

- Understanding buffers
- Buffer operations
- Buffer analysis
- Common use cases

#### Applications
- Proximity analysis: Identify roads within a certain distance of specific landmarks
- Safety assessment: Pinpoint intersections prone to accidents
- Visit attribution: Determine visitors based on mobile GPS data to optimize store locations
- Site selection: Find buildings adjacent to parks
- Environmental monitoring: Identify watersheds within a certain distance of pollutant sources

#### Exercise
- Create buffers around points and lines
- Analyze buffer intersections
- Calculate buffer statistics
- Apply buffers to real-world problems

#### Code Examples
```python
@fused.udf
def udf(n_points: int=1000, buffer: float=0.0025):
    import geopandas as gpd
    from shapely.geometry import Point, Polygon, LineString
    import random

    # Create LineString to represent a road
    linestring_columbus = LineString([[-122.4194,37.8065],[-122.4032,37.7954]])
    gdf_road = gpd.GeoDataFrame({'geometry': [linestring_columbus], 'name': ['Columbus Ave']})

    # Create Points to represent GPS pings
    minx, miny, maxx, maxy = gdf_road.total_bounds
    points = [Point(random.uniform(minx, maxx), random.uniform(miny, maxy)) for _ in range(n_points)]
    gdf_points = gpd.GeoDataFrame({'geometry': points})

    # Create a buffer around the road
    buffered_polygon = gdf_road.buffer(buffer)

    # Color the points that fall within the buffered polygon
    points_within = gdf_points[gdf_points.geometry.within(buffered_polygon.unary_union)]
    gdf_points = gdf_points.loc[points_within.index]

    return gdf_points
```

#### Implementation Steps
1. Represent road segments as LineStrings and vehicle GPS locations as Points
2. Create a buffer around a set of target roads
3. Call the within method to check which GPS points fall within the buffer

#### Important Considerations
- Buffers of different Areas of Interest (AOI) may intersect
- Ambiguous situations where a single point falls within multiple buffers
- Use-case specific handling of overlapping buffers:
  - Road analysis: A car can't be on two roads simultaneously
  - Building analysis: A building can be within multiple buffer zones
- Additional techniques may be needed to resolve ambiguities:
  - Speed or direction of travel for road analysis
  - Multiple buffer analysis for comprehensive insights

### 03. Spatial Joins
[![Open In Workbench Collection](https://img.shields.io/badge/Open_In_Workbench_Collection-4-green?style=for-the-badge)](https://www.fused.io/workbench/catalog/Fused_Course_Module1-37ec2eb3-6481-4cb1-b406-f8e39c339a52)

- Understanding spatial joins
- Different types of spatial relationships
- Performance considerations
- Common use cases

#### Applications
- Enriching building data with hazard metadata
- Analyzing points within administrative boundaries
- Combining different spatial datasets
- Risk assessment and analysis

#### Exercise
- Perform different types of spatial joins
- Analyze join performance
- Handle complex spatial relationships
- Apply joins to real-world scenarios

#### Code Examples
```python
@fused.udf
def udf(bounds: fused.types.Bounds=None):
    # Import utility functions
    utils = fused.load("https://github.com/fusedio/udfs/blob/main/public/Nsi_Overture/").utils

    # Load both datasets
    gdf_overture = utils.load_overture_gdf(bounds, overture_type = "building")
    gdf_nsi = utils.load_nsi_gdf(bounds)

    # Spatial join - keeps the polygon geometry
    gdf_enriched_buildings = gdf_overture.sjoin(gdf_nsi)

    # Drop cases where two points fall within one polygon
    gdf_enriched_buildings.drop_duplicates(subset='id', keep='first', inplace=True, ignore_index=True)
    return gdf_enriched_buildings
```

#### Implementation Steps
1. Load data for each dataset as a GeoDataFrame for a spatially filtered subregion
2. Use the GeoPandas method sjoin to determine which points lie within each polygon
3. Structure the output table with enriched data

#### Output Structure
The UDF returns a GeoDataFrame with:
- Building geometry from Overture
- Hazard metadata from NSI
- Additional attributes like:
  - Building ID
  - Names
  - Damage categories
  - Occupancy types
  - Construction years
  - Value estimates

#### Important Considerations
- Handle duplicate entries when multiple points fall within one polygon
- Consider spatial indexing for performance optimization
- Choose appropriate join predicates (within, intersects, etc.)
- Validate data quality and completeness



## Module 2: Advanced Spatial Operations

### 01. Spatial Aggregations
[![Open In Workbench Collection](https://img.shields.io/badge/Open_In_Workbench_Collection-4-green?style=for-the-badge)](https://www.fused.io/workbench/catalog/Fused_Course_Module1-37ec2eb3-6481-4cb1-b406-f8e39c339a52)

- Aggregating spatial data
- Grouping by spatial attributes
- Statistical operations
- Optimization techniques

#### Exercise
- Perform spatial aggregations
- Calculate statistics for spatial groups
- Optimize aggregation operations
- Apply aggregations to analysis problems

#### Code Examples
```python
@fused.udf
def udf():
    import geopandas as gpd
    import requests
    
    # Load data
    DATASET = 'https://raw.githubusercontent.com/python-visualization/folium-example-data/main/us_states.json'
    gdf = gpd.GeoDataFrame.from_features(requests.get(DATASET).json())
    
    # Group by region and calculate statistics
    grouped = gdf.groupby('region')
    stats = grouped.agg({
        'population': ['mean', 'sum', 'count']
    })
    
    return stats
```

### 02. Spatial Indexing
[![Open In Workbench Collection](https://img.shields.io/badge/Open_In_Workbench_Collection-4-green?style=for-the-badge)](https://www.fused.io/workbench/catalog/Fused_Course_Module1-37ec2eb3-6481-4cb1-b406-f8e39c339a52)

- Understanding spatial indexes
- Creating and using indexes
- Performance optimization
- Best practices

#### Exercise
- Create and use spatial indexes
- Compare performance with and without indexes
- Optimize spatial queries
- Apply indexing to large datasets

#### Code Examples
```python
@fused.udf
def udf():
    import geopandas as gpd
    import requests
    
    # Load data
    DATASET = 'https://raw.githubusercontent.com/python-visualization/folium-example-data/main/us_states.json'
    gdf = gpd.GeoDataFrame.from_features(requests.get(DATASET).json())
    
    # Create spatial index
    spatial_index = gdf.sindex
    
    # Perform spatial query
    bounds = (0, 0, 1, 1)
    possible_matches = list(spatial_index.intersection(bounds))
    
    return gdf.iloc[possible_matches]
```

### 03. Complex Spatial Queries
[![Open In Workbench Collection](https://img.shields.io/badge/Open_In_Workbench_Collection-4-green?style=for-the-badge)](https://www.fused.io/workbench/catalog/Fused_Course_Module1-37ec2eb3-6481-4cb1-b406-f8e39c339a52)

- Complex spatial relationships
- Advanced spatial queries
- Spatial analysis patterns
- Real-world applications

#### Exercise
- Perform complex spatial queries
- Analyze spatial relationships
- Apply spatial analysis patterns
- Solve real-world problems

#### Code Examples
```python
@fused.udf
def udf():
    import geopandas as gpd
    import requests
    
    # Load data
    BUILDINGS = 'https://raw.githubusercontent.com/python-visualization/folium-example-data/main/buildings.json'
    ROADS = 'https://raw.githubusercontent.com/python-visualization/folium-example-data/main/roads.json'
    
    buildings = gpd.GeoDataFrame.from_features(requests.get(BUILDINGS).json())
    roads = gpd.GeoDataFrame.from_features(requests.get(ROADS).json())
    
    # Complex spatial query
    buildings_near_roads = gpd.sjoin(
        buildings,
        roads,
        how="inner",
        predicate="intersects"
    )
    
    return buildings_near_roads
```

### 04. Performance Optimization
[![Open In Workbench Collection](https://img.shields.io/badge/Open_In_Workbench_Collection-4-green?style=for-the-badge)](https://www.fused.io/workbench/catalog/Fused_Course_Module1-37ec2eb3-6481-4cb1-b406-f8e39c339a52)

- Optimizing spatial operations
- Handling large datasets
- Performance best practices
- Real-world optimization

#### Exercise
- Optimize spatial operations
- Handle large datasets efficiently
- Apply performance best practices
- Optimize real-world workflows

#### Code Examples
```python
@fused.udf
def udf(bounds: fused.types.Bounds = None):
    # Using common fused functions as helper
    common = fused.load("https://github.com/fusedio/udfs/tree/1bafbfe/public/common/").utils
    
    # Optimize by using tiles
    tiles = common.get_tiles(bounds, target_num_tiles=16)
    
    # Process each tile efficiently
    results = []
    for tile in tiles.itertuples():
        # Process tile data
        processed = process_tile(tile)
        results.append(processed)
    
    return gpd.GeoDataFrame(results)
```

