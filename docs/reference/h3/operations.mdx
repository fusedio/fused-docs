---
title: H3 Operations
sidebar_label: Operations
sidebar_position: 3
description: Copy-paste snippets for common H3 operations
---

# H3 Operations

Quick reference for common H3 operations. For detailed guides, see [H3 Hexagons Guide](/guide/h3-hexagons/).

## Point to H3

```python
import h3

lat, lon = 37.7749, -122.4194
hex_id = h3.latlng_to_cell(lat, lon, resolution=9)
```

## DataFrame Points to H3

```python
df['hex'] = df.apply(
    lambda row: h3.latlng_to_cell(row['lat'], row['lon'], 9), 
    axis=1
)
```

## Polygon to H3

```python
import h3

# GeoJSON polygon
polygon = {"type": "Polygon", "coordinates": [...]}
hexes = h3.polygon_to_cells(polygon, resolution=9)
```

## H3 to Geometry

```python
import h3
from shapely.geometry import Polygon

hex_id = "89283082837ffff"
boundary = h3.cell_to_boundary(hex_id)
polygon = Polygon(boundary)
```

---

## Aggregations

### Count

```python
df.groupby('hex').size().reset_index(name='count')
```

### Sum

```python
df.groupby('hex')['value'].sum()
```

### Mean

```python
df.groupby('hex')['value'].mean()
```

### Mode (Most Common)

```python
df.groupby('hex')['category'].agg(lambda x: x.mode().iloc[0])
```

### Multiple Aggregations

```python
df.groupby('hex').agg({
    'population': 'sum',
    'income': 'mean',
    'category': lambda x: x.mode().iloc[0]
})
```

---

## Resolution Changes

### Coarsen (Parent)

```python
import h3

df['hex_coarse'] = df['hex'].apply(lambda x: h3.cell_to_parent(x, 6))
```

### Refine (Children)

```python
import h3

children = h3.cell_to_children(hex_id, 10)
```

### Get Resolution

```python
import h3

res = h3.get_resolution(hex_id)
```

---

## Spatial Operations

### Get Neighbors

```python
import h3

neighbors = h3.grid_ring(hex_id, k=1)  # Ring at distance 1
disk = h3.grid_disk(hex_id, k=2)       # Disk up to distance 2
```

### Distance Between Cells

```python
import h3

distance = h3.grid_distance(hex1, hex2)  # In cells
```

---

## DuckDB H3 Functions

```sql
-- Convert point to H3
SELECT h3_latlng_to_cell(lat, lng, 9) as hex FROM points;

-- Get parent
SELECT h3_cell_to_parent(hex, 6) as parent FROM hexes;

-- Get neighbors
SELECT UNNEST(h3_grid_ring(hex, 1)) as neighbor FROM hexes;

-- Cell area
SELECT h3_get_hexagon_area_avg(9, 'm^2') as area;
```

---

## Common Patterns

### Dynamic Resolution from Bounds

```python
common = fused.load("https://github.com/fusedio/udfs/tree/main/public/common/")

zoom = common.estimate_zoom(bounds)
res = max(3, min(12, int(3 + (zoom - 3) / 1.7)))
```

### Read H3 Dataset

```python
hex_reader = fused.load("https://github.com/fusedio/udfs/tree/main/community/joris/Read_H3_dataset/")
df = hex_reader.read_h3_dataset(path, bounds, res=None)
```

