---
slug: realtime-data-processing
title: Realtime data processing
---

# Realtime data filtering with DuckDB WASM

This tutorial will show you how to build a real time filtering visualization using DuckDB WASM:

<iframe
  src="https://www.fused.io/server/v1/realtime-shared/UDF_WASM_Filtering_CDL/run/file"
  width="100%"
  height="600px"
  frameBorder="0"
></iframe>

[Open in a new tab](https://www.fused.io/server/v1/realtime-shared/UDF_WASM_Filtering_CDL/run/file)

This map:
- Fetches data from a Fused UDF (which aggregates & cleans data into hex5), uses DuckDB WASM to filter it and renders the output on a map
- Data comes from [Source Cooperative](https://source.coop/fused/hex/release_2025_04_beta/cdl) based on 2024 USDA Crop Data Layer

This is how to build this step by step:

# 1. Querying data with DuckDB WASM

The simplest way to use DuckDB in the browser is to use DuckDB WASM to query a hosted file. 

You can directly edit the SQL query directly here:

<iframe 
    style={{
        width: "100%",
        height: "200px",
        minHeight: "400px", 
        margin: "0 auto",
        display: "block",
        border: "1px solid #e1e5e9",
        borderRadius: "8px"
    }}
    src="https://www.fused.io/server/v1/realtime-shared/UDF_Duckdb_Table_loading_from_s3/run/file"
    title="DuckDB WASM Data Loading Demo"
    frameBorder="0"
    allowFullScreen
    allow="fullscreen">
</iframe>

This UDF:
- Signs S3 once so browser can fetch it
- Loads parquet as view `df`
- Auto-runs query as you type (small debounce)
- 'Run' button stays disabled until data is ready and becomes optional

See the code in [Fused Catalog](https://www.fused.io/workbench/catalog/Duckdb_Table_loading_from_s3-f34e72ff-592b-443d-b987-0bc667980463)

## 2. Calling data from a UDF

Instead of loading data directly into DuckDB WASM we can write a Fused UDF that:
- Creates a new features
- Only keeps a subset of data

<iframe 
    style={{
        width: "100%",
        height: "200px",
        minHeight: "400px", 
        margin: "0 auto",
        display: "block",
        border: "1px solid #e1e5e9",
        borderRadius: "8px"
    }}
    src="https://www.fused.io/server/v1/realtime-shared/UDF_Airbnb_listings_nyc_parquet/run/file?dtype_out_vector=html"
    title="DuckDB WASM Data Loading Demo"
    frameBorder="0"
    allowFullScreen
    allow="fullscreen">
</iframe>

[Link to code](https://www.fused.io/workbench/catalog/Airbnb_listings_nyc_parquet-6a406e93-b3cd-4428-8979-93c1e1e065b3)

Then call this UDF directly in DuckDB WASM:

<iframe 
    style={{
        width: "100%",
        height: "200px",
        minHeight: "400px", 
        margin: "0 auto",
        display: "block",
        border: "1px solid #e1e5e9",
        borderRadius: "8px"
    }}
    src="https://www.fused.io/server/v1/realtime-shared/UDF_Duckdb_Table_from_UDF/run/file"
    title="DuckDB WASM Data Loading Demo"
    frameBorder="0"
    allowFullScreen
    allow="fullscreen">
</iframe>

[Link to code](https://www.fused.io/workbench/catalog/Duckdb_Table_from_UDF-3f49b887-bb8e-4099-8a00-daf86792ecb4)

## 3. Rendering output on a map 

After filtering the data with DuckDB WASM you can also directly pass it to a map component:

<iframe 
    style={{
        width: "100%",
        height: "200px",
        minHeight: "500px", 
        margin: "0 auto",
        display: "block",
        border: "1px solid #e1e5e9",
        borderRadius: "8px"
    }}
    src="https://www.fused.io/server/v1/realtime-shared/UDF_Simple_Map_Duckdb_WASM_with_input/run/file"
    title="DuckDB WASM Data Loading Demo"
    frameBorder="0"
    allowFullScreen
    allow="fullscreen">
</iframe>

[Link to code](https://www.fused.io/workbench/catalog/Simple_Map_Duckdb_WASM_with_input-214a4c1d-4046-48e3-a12a-ad62a0ddfbed)

## Real world example: Visualizing Crops in the USA

Data: USDA Crop Data Layer (2024)
From: [Source Cooperative](https://source.coop/fused/hex)
Format: Fused [repartitioned this into H3 hexagons](https://docs.fused.io/blog/cdl-census-hex) as hex7

```bash
https://source.coop/fused/hex/release_2025_04_beta/cdl/hex7_2024.parquet
```


### Processing Data with DuckDB

Before we display the data we want to:
- Remove any nodata (`0`) in CDL
- Calculate the percentage that each crop type makes up of the total area of each hex8 cell 
- Return `lat / lon` coordinates for each hex8 cell to be able to display the data on a map

We can write a simple UDF to do this for us:

<iframe 
    style={{
        width: "100%",
        height: "200px",
        minHeight: "400px", 
        margin: "0 auto",
        display: "block",
        border: "1px solid #e1e5e9",
        borderRadius: "8px"
    }}
    src="https://www.fused.io/server/v1/realtime-shared/UDF_CDL_Data_Filtering/run/file?dtype_out_vector=html"
    title="CDL processing to hex 5"
    frameBorder="0"
    allowFullScreen
    allow="fullscreen">
</iframe>

[Link to code](https://www.fused.io/workbench/catalog/CDL_Data_Filtering-b9fff8ac-3e4e-4241-a25c-b25ea6dd3754)

This returns a dataframe directly. We can then pass this data to another UDF to render it on a map.

## Live filtering on Map

<iframe
  src="https://www.fused.io/server/v1/realtime-shared/UDF_WASM_Filtering_CDL/run/file?dtype_out_raster=png&dtype_out_vector=html"
  width="100%"
  height="600px"
  frameBorder="0"
></iframe>

[Link to code](https://www.fused.io/workbench/catalog/WASM_Filtering_CDL-8256b64a-df26-4717-979a-0dc27b377560)

Here's how the map is built:

1. Data Source: Fetches Parquet from previous UDF
2. Browser Database: Loads into DuckDB WASM with H3/spatial extensions
3. Real-time Filtering: Applies SQL WHERE conditions on user input
4. Geometry Generation: Converts H3 cells to hexagon boundaries
5. Map Visualization: Renders colored hexagons with tooltips
6. Live Statistics: Shows count, area, and averages for filtered data


### Explore on canvas

You can see this tutorial as a Fused Canvas:

<iframe 
    style={{
        width: "100%",
        height: "600px",
        minHeight: "500px",
        margin: "0 auto",
        display: "block",
        border: "1px solid #e1e5e9",
        borderRadius: "8px"
    }}
    src="https://www.fused.io/canvas/fc_31dKPa7L1ormNstj6z3geY" 
    title="Fused Canvas - Realtime Data Processing Dashboard" 
    frameBorder="0" 
    allowFullScreen
    allow="fullscreen">
</iframe>

[Open in a new tab](https://www.fused.io/canvas/fc_31dKPa7L1ormNstj6z3geY)

## Want to try it yourself?

You can book a demo directly with Max, our Developer Advocate, right [here](https://calendly.com/max-fused/30min)!

We'd love to show you how to build this for yourself!

Sign up for a free account [here](https://www.fused.io/workbench) and try it out for yourself!

