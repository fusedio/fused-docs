---
sidebar_label: "End-to-end Example: Dark Vessel Detection"
title: "End-to-end Example: Dark Vessel Detection"
tags: ['example', 'sentinel 1', 'raster', 'vector', 'ingestion']
sidebar_custom_props:
    name: "End-to-end example: Dark Vessel Detection"
    image: 'https://fused-magic.s3.us-west-2.amazonaws.com/thumbnails/udfs-staging/Fused_Logo.png'
    url: "/user-guide/examples/dark-vessel-detection"
    urlTS: "/user-guide/examples/dark-vessel-detection"
    description: 'Using Sentinel 1 radar images + AIS ship data to detect potential illegal ship activity'
---

_A complete example show casing how to use Fused to ingest data into a geo-partitioned, cloud friendly format, process images & vectors and use UDFs to produce an analysis_

## 1. The problem: Detecting illegal boats

{/* Start by showing what the end result looks like: "this is what we're going to do in this example"*/}

Monitoring what happens at sea isn't the easiest task. Shores are outfitted with radars and each ship has a transponder to publicly broadcast their location (using [Automatic Identification System, AIS](https://en.wikipedia.org/wiki/Automatic_identification_system)), but ships sometimes want to hide their location when taking part in illegal activities. 

Global Fishing Watch [has reported on "dark vessels"](https://globalfishingwatch.org/research-project-dark-vessels/) comparing Sentinel 1 radar images to public AIS data and matching the two to compare where boats report being versus where they _actually_ are. 

In this example, we're going to showcase a basic implementation of a similar analysis to identify _potential_ dark vessels, all in Fused.

import ImageWorkflow from '@site/docs/user-guide/examples/dark_vessel_methodology.png';

<div style={{textAlign: 'center'}}>
<img src={ImageWorkflow} alt="Dark Vessel Detection workflow" style={{width: 1000}} />
</div>

Here's the result of our analysis, running in real time in Fused:

import ReactPlayer from 'react-player'

{/* <ReactPlayer playsinline={true} className="video__player" playing={true} muted={true} controls height="100%" url="https://fused-magic.s3.us-west-2.amazonaws.com/workbench-walkthrough-videos/docs_rewrite/examples/dark-vessel-detection/output_analysis_S1_ais.mp4" width="100%" /> */}
<ReactPlayer playsinline={true} className="video__player" playing={true} muted={true} controls height="100%" url="https://fused-magic.s3.us-west-2.amazonaws.com/workbench-walkthrough-videos/docs_rewrite/examples/dark-vessel-detection/analysis_walkthrough_dark_vessel_detection.mp4" width="100%" />

{/* Need more context around how the analysis is done */}

Here are the steps we'll produce:
- Getting Sentinel 1 radar images over our Area of Interest and within our Time of Interest
- Run a simple algorithm to detect bright spots in radar images -> Return boats outline
- Fetch AID data over the same Area & Time of Interest
- Merge the 2 datasets together
- Keep boats that appear in Sentinel 1 but not in AIS -> Those are our potential Dark Vessels.

import ImageDataPipeline from '@site/docs/user-guide/examples/dark_vessel_data_breakdown.png';

<div style={{textAlign: 'center'}}>
<img src={ImageDataPipeline} alt="Dark Vessel Detection data pipeline" style={{width: 1000}} />
</div>


:::note
    This is crude analysis, mostly meant to demonstrate some of the major components of Fused, not to expose any dark vessels. The analysis has some major limitations and itself should be taken with a grain of salt. 
    
    That being said, we encourage you to use it as a starting point for your own work!
:::



## 2. Data for our analysis

We need 2 main datasets:
- [Sentinel 1 radar images](https://sentinel.esa.int/web/sentinel/copernicus/sentinel-1)
- [AIS data](https://en.wikipedia.org/wiki/Automatic_identification_system)

Both of which are free & open data sources. Since we want our analysis to take only a few seconds at most to run our data needs to be **fast to read** & **scalable to access**.

{/* Need a link towards cloud native so people can read more about this somewhere else */}
This is why we want both of our datasets to in a Cloud Native format. At the highest level and in practice this means that our data is:
- On a cloud storage (i.e. on S3 buckets)
- In a format that's fast to read and allows loading only small areas at a time ([Cloud Optimized GeoTiff](https://cogeo.org/) or [GeoParquet](https://geoparquet.org/))

{/* Need a blogpost / docs page about "why cloud native" or something along those lines */}

After looking around at different options we're going to use:
- Sentinel 1 data from the [Microsoft Planetary Computer Data Catalog](https://planetarycomputer.microsoft.com/dataset/sentinel-1-grd)

    For the nerds out there, we're using the Ground Range Detected product, not the [Radiometrically Terrain Corrected](https://planetarycomputer.microsoft.com/dataset/sentinel-1-rtc) because we're looking at boats in the middle of the ocean, so terrain shouldn't be any issue.
    - This dataset is available as Cloud Optimized GeoTiff through a [STAC Catalog](https://stacspec.org/en/), meaning we can directly use this data as is.

- AIS data from the [NOAA Digital Coast](https://www.coast.noaa.gov/digitalcoast/tools/ais.html). We have data all around the continental US [per day as individual `.zip` files](https://coast.noaa.gov/htdata/CMSP/AISDataHandler/2024/index.html)
    - This dataset is not in a cloud native format. If we were to use this directly, every time we were to make a change to our analysis or look at a new area we'd have to find the correct `.zip` file, decompress it, read the entire AIS data for any given day then query only around our area of interest. This is possible, but brings out iteration speed from seconds to minutes.

import ImgAISNoaa from '@site/docs/user-guide/examples/AIS_noaa_coast_portal.png';

<div style={{textAlign: 'center'}}>
<img src={ImgAISNoaa} alt="Dark Vessel Detection data pipeline" style={{width: 600}} />
</div>

## 3. Ingesting AIS data

Since our AIS dataset is not in a geo-partitioned, cloud native format, our first step is to ingest it into a tiled format and put it on a cloud bucket. Thankfully we can do all of this in Fused.

By the end of this ingestion process we'll have:
- AIS data for 2024 on a cloud storage (AWS S3 bucket)
- In a GeoParquet format so it's fast to read
- Tiled & Chunked so we can read only a small portion at a time, making it even faster

{/* 
Topics:
- Sentinel 1 already in COG + STAC -> No need to do ingest it ourselves
- AIS is in zip files on a server somewhere -> we're going to re-ingest it ourselves to make it cloud native (i.e. on cloud on S3 bucket) + geo-partitioned (i.e. in a format that's fast to read - parquet + chunked accordingly) 
 */}

_ðŸš§ Under construction_

## 4. Retrieving Sentinel 1 images

_ðŸš§ Under construction_

## 5. Simple boat detection in Sentinel 1 radar images

_ðŸš§ Under construction_

## 6. Retrieving AIS data for our time of Interest

_ðŸš§ Under construction_

## 7. Merging the 2 datasets together

_ðŸš§ Under construction_

## Limitations & Next steps

{/* 
Talk about how this analysis is quite simple, but a good starting point 
Next steps:
- 
*/}

_ðŸš§ Under construction_