---
id: styling
title: Layer styling
tags: [styling]
sidebar_position: 2
toc_min_heading_level: 2
toc_max_heading_level: 6
---



To style the visual representation of a UDF's output, configure it under the "Visualization" tab. The Workbench DeckGL map uses [`@deck.gl/json`](https://deck.gl/docs/api-reference/json/conversion-reference) to implement a `TileLayer` with a sublayer for either a `rasterLayer` or a `vectorLayer` - both are set by default for flexibility, but only the one corresponding to the UDF output type is used.

import VizTab from "/img/viz_tab.png";

<div style={{ textAlign: "center" }}>
  <img src={VizTab} alt="Gls" style={{}} />
</div>

Styles to keep in mind are `H3HexagonLayers` and Vector `GeoJsonLayer`.

## `H3HexagonLayer`

The visualization json for a H3HexagonLayer that for a returned `DataFrame` dynamically sets `getHexagon` from an H3 index column (every row must be at the same H3 resolution), then `getFillColor` & `getElevation` properties from a value column might look like this.



```json
{
  "tileLayer": {
    "@@type": "TileLayer",
    "minZoom": 0,
    "maxZoom": 19,
    "tileSize": 256,
    "pickable": true
  },
  "vectorLayer": {
    "opacity": 2,
    "@@type": "H3HexagonLayer",
    "stroked": true,
    "filled": true,
    "pickable": true,
    "getHexagon": "@@=hex",
    "getFillColor": "@@=[count, count, count]",
    "getElevation": "@@=count",
    "elevationScale": 4
  }
}
```
          


<iframe
  src="/img/deckgl_h3.html"
  height="400px"
  width="100%"
  scrolling="no"
></iframe>

## Vector `GeoJsonLayer`

The visualization json for a vector tile layer that dynamically sets `getLineColor` properties from the returned GeoDataFrame might look like this.

import GlsTile from "/img/vector-viz.png";

<div style={{ textAlign: "center" }}>
  <img src={GlsTile} alt="Gls" style={{  }} />
</div>

```json
{
  "tileLayer": {
    "@@type": "TileLayer",
    "minZoom": 0,
    "maxZoom": 15,
    "tileSize": 256,
    "pickable": true
  },
  "vectorLayer": {
    "@@type": "GeoJsonLayer",
    "stroked": true,
    "filled": true,
    "pickable": true,
    "extruded": true,
    "getElevation": "@@=properties.stats*1",
    "lineWidthMinPixels": 1,
    "getLineColor": {
      "@@function": "hasProp",
      "property": "stats",
      "present": "@@=[properties.stats*5, properties.stats*3, properties.stats*2]",
      "absent": [255, 0, 255]
    },
    "getFillColor": "@@=[properties.stats*5, properties.stats*3, properties.stats*2]"
  }
}
```


### Color styling

There are 4 ways to set the color for the stroke (`getLineColor`) and fill (`getFillColor`) of a `GeoJsonLayer`. These examples show how to set it for the fill with `getFillColor`, and the same syntax applies for the stroke with `getLineColor`. They all modify the visualization config for this UDF.

```python
@fused.udf
def udf(
    bbox: fused.types.Bbox = None,
    table_path: str = "s3://fused-asset/infra/building_msft_us/",
):
    import numpy as np
    import random
    utils = fused.load("https://github.com/fusedio/udfs/tree/eda5aec/public/common/").utils

    # Load data
    gdf=utils.table_to_tile(bbox, table=table_path)

    # Assign random numbers
    gdf['value'] = np.random.randint(0,10, len(gdf))

    # Assign random classes
    categories = ['residential', 'commercial', 'health', 'public']
    gdf['class'] = [random.choice(categories) for _ in range(len(gdf))]
    
    print(gdf)
    return gdf
```


#### Single


```json
{
  "tileLayer": {
    "@@type": "TileLayer",
    "minZoom": 0,
    "maxZoom": 19,
    "tileSize": 256,
    "pickable": true
  },
  "rasterLayer": {
    "@@type": "BitmapLayer",
    "pickable": true
  },
  "vectorLayer": {
    "@@type": "GeoJsonLayer",
    "stroked": true,
    "filled": true,
    "pickable": true,
    "lineWidthMinPixels": 1,
    "pointRadiusMinPixels": 1,
    "getFillColor": [20,200,200,100]
  }
}
```

                


import ImgSingleColor from '@site/static/img/viz_single.png';

          <img src={ImgSingleColor} alt="File" style={{ width: '100%', height: '100%', objectFit: 'cover' }} />


#### Based on a property value



import ImgProperty from '@site/static/img/viz_property.png';

<div style={{textAlign: 'center'}}>
<img src={ImgProperty} alt="File" style={{width: 600}} />
</div>



```json
{
  "tileLayer": {
    "@@type": "TileLayer",
    "minZoom": 0,
    "maxZoom": 15,
    "tileSize": 256,
    "pickable": true
  },
  "rasterLayer": {
    "@@type": "BitmapLayer",
    "pickable": true
  },
  "vectorLayer": {
    "@@type": "GeoJsonLayer",
    "stroked": true,
    "filled": true,
    "pickable": true,
    "extruded": true,
    "getElevation": "@@=properties.stats*1",
    "lineWidthMinPixels": 1,
    "getFillColor": "@@=[properties.value*50, properties.value*30, properties.value*2]"
  }
}
```

Alternatively, to support a default color when a value is absent.

```json
{
  "tileLayer": {
    "@@type": "TileLayer",
    "minZoom": 0,
    "maxZoom": 15,
    "tileSize": 256,
    "pickable": true
  },
  "rasterLayer": {
    "@@type": "BitmapLayer",
    "pickable": true
  },
  "vectorLayer": {
    "@@type": "GeoJsonLayer",
    "stroked": true,
    "filled": true,
    "pickable": true,
    "extruded": true,
    "getElevation": "@@=properties.stats*1",
    "lineWidthMinPixels": 1,
    "getFillColor": {
      "@@function": "hasProp",
      "property": "value",
      "present": "@@=[properties.value*50, properties.value*3, properties.value*2]",
      "absent": [
        255,
        0,
        255
      ]
    }
  }
}
```





#### `colorCategories`



```json
{
  "tileLayer": {
    "@@type": "TileLayer",
    "minZoom": 0,
    "maxZoom": 19,
    "tileSize": 256,
    "pickable": true
  },
  "rasterLayer": {
    "@@type": "BitmapLayer",
    "pickable": true
  },
  "vectorLayer": {
    "@@type": "GeoJsonLayer",
    "stroked": true,
    "filled": true,
    "pickable": true,
    "lineWidthMinPixels": 1,
    "pointRadiusMinPixels": 1,
    "getFillColor": {
      "@@function": "colorCategories",
      "attr": "class",
      "domain": [
        "residential", 
        "commercial", 
        "health", 
        "public"
      ],
      "colors": "Bold"
    }
  }
}
```

                

import ImgCategory from '@site/static/img/viz_category.png';

          <img src={ImgCategory} alt="File" style={{ width: '100%', height: '100%', objectFit: 'cover' }} />




:::warning
Note that unexpected behaviors may arise if too many domains are used.
:::


#### `colorContinuous`



```json
{
  "tileLayer": {
    "@@type": "TileLayer",
    "minZoom": 0,
    "maxZoom": 19,
    "tileSize": 256,
    "pickable": true
  },
  "rasterLayer": {
    "@@type": "BitmapLayer",
    "pickable": true
  },
  "vectorLayer": {
    "@@type": "GeoJsonLayer",
    "stroked": true,
    "filled": true,
    "pickable": true,
    "lineWidthMinPixels": 1,
    "pointRadiusMinPixels": 1,
    "getFillColor": {
      "@@function": "colorContinuous",
      "attr": "value",
      "domain": [
        0,
        10
      ],
      "colors": "Peach",
      "nullColor": [
        184,
        184,
        184
      ]
    }
  }
}
```

                

import ImgContinuous from '@site/static/img/viz_continuous.png';

          <img src={ImgContinuous} alt="File" style={{ width: '100%', height: '100%', objectFit: 'cover' }} />


## Raster `BitmapLayer`


Raster layers can be set to display a tooltip on hover by setting the `pickable` property to `true`. See [DeckGL documentation](https://deck.gl/docs/api-reference/layers/bitmap-layer#pixel-picking).

import RP from '@site/static/img/raster-pickable.png';

<div style={{textAlign: 'center'}}>
<img src={RP} alt="File" style={{}} />
</div>


```json
{
  "tileLayer": {
    "@@type": "TileLayer",
    "minZoom": 0,
    "maxZoom": 19,
    "tileSize": 256,
    "pickable": true
  },
  "rasterLayer": {
    "@@type": "BitmapLayer",
    "pickable": true
  }
}
```

:::tip
ðŸ’¡ There's 2 recommended ways to control the transparency of raster images.

  1. In RGB images, the color black (0,0,0) is automatically set to full transparency.
  2. If a 4 channel array is passed, i.e. RGBA, the value of the 4th channel is the transparency.
:::

## Custom `loadingLayer` and `errorLayer`

When `tileLayer` has `"@@type": "DebugTileLayer"` set `loadingLayer` and `errorLayer` can be configured to show the user that the UDF is still processing or that an error occurred. This is helpful for debugging.

![alt text](https://fused-magic.s3.us-west-2.amazonaws.com/docs_assets/gifs/debug_viz.gif)

```json
{
  "tileLayer": {
    "@@type": "DebugTileLayer",
    "minZoom": 0,
    "maxZoom": 15,
    "tileSize": 256,
    "pickable": true
  },
  "rasterLayer": {
    "@@type": "BitmapLayer",
    "pickable": true
  },
  "vectorLayer": {
    "@@type": "GeoJsonLayer",
    "stroked": true,
  },
  "loadingLayer": {
    "@@type": "GeoJsonLayer",
    "stroked": true,
    "filled": false,
    "pickable": true,
    "lineWidthMinPixels": 10,
    "getLineColor": [
      25,
      55,
      0,
      255
    ],
    "getFillColor": [
      5,
      20,
      255,
      40
    ]
  },
  "errorLayer": {
    "@@type": "GeoJsonLayer",
    "stroked": true,
    "filled": true,
    "pickable": true,
    "lineWidthMinPixels": 10,
    "getLineColor": [
      255,
      255,
      0,
      255
    ],
    "getFillColor": [
      255,
      20,
      255,
      40
    ]
  }
}
```