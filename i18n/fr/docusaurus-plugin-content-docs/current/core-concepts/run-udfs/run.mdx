---
id: run-small-udfs
title: Realtime
tags: [write, endpoints, api, http, file, tile]
sidebar_position: 1
toc_min_heading_level: 2
toc_max_heading_level: 4
---

Les UDF brillent vraiment une fois que vous commencez √† les appeler de n'importe o√π. Realtime est la m√©thode par d√©faut pour ex√©cuter des UDF. Vous pouvez les ex√©cuter de 2 mani√®res principales :
1.  [`fused.run()`](/python-sdk/top-level-functions/#fusedrun) en Python. Tout ce dont vous avez besoin est le package [`fused` Python](/python-sdk/#python-install) install√©
    - Utile lorsque vous souhaitez ex√©cuter un UDF dans le cadre d'un autre pipeline, √† l'int√©rieur d'un autre UDF ou n'importe o√π dans Python / le code.
2.  [**Appel HTTPS**](/core-concepts/run-udfs/run-small-udfs/#https-requests) depuis *n'importe o√π*
    - Utile lorsque vous souhaitez appeler un UDF en dehors de Python. Par exemple, recevoir des dataframes dans Google Sheets ou tracer des points et des images dans une [carte Felt](/tutorials/Geospatial%20with%20Fused/other-integrations/#felt)
{/* TODO: Might want to mention `fused.submit()` here to be able to run multiple jobs? */}

### D√©finir les ex√©cutions UDF en temps r√©el

Les ex√©cutions UDF en temps r√©el sont d√©finies comme tout travail √©tant :
- Moins de 120s √† ex√©cuter
- Utilisant moins de quelques Go de RAM pour s'ex√©cuter

Celles-ci s'ex√©cutent en "temps r√©el" sans temps de d√©marrage, donc sont rapides √† ex√©cuter, mais avec des ressources limit√©es et un d√©lai d'attente si cela prend trop de temps.

## [`fused.run()`](/python-sdk/top-level-functions/#fusedrun)

[`fused.run()`](/python-sdk/top-level-functions/#fusedrun) est la mani√®re la plus simple et la plus courante d'ex√©cuter un UDF depuis n'importe quel script ou notebook Python.

La mani√®re la plus simple d'appeler un UDF public est d'utiliser un [nom d'UDF public](/core-concepts/run-udfs/run-small-udfs/#public-udf-name) et de l'appeler comme : `UDF_` + nom. Prenons cet UDF qui renvoie [l'emplacement de la Tour Eiffel](https://github.com/fusedio/udfs/tree/main/public/Single_point_Eiffel_Tower) dans un `GeoDataFrame` comme exemple :

```python showLineNumbers
fused.run("UDF_Single_point_Eiffel_Tower")
```


![Simple UDF fused.run() returning a geodataframe](/img/core-concepts/run-udfs/running_simple_eiffel_tower_udf.png)

Il existe quelques autres fa√ßons d'ex√©cuter un UDF :

- [Par nom depuis votre compte](/core-concepts/run-udfs/run-small-udfs/#name-from-your-account)
- [Par nom d'UDF public](/core-concepts/run-udfs/run-small-udfs/#public-udf-name)
- [En utilisant un token](/core-concepts/run-udfs/run-small-udfs/#token)
- [En utilisant un objet `udf`](/core-concepts/run-udfs/run-small-udfs/#udf-object)
- [Depuis l'URL Github](/core-concepts/run-udfs/run-small-udfs/#github-url)
- [Depuis le hash de commit git (le plus recommand√© pour les √©quipes)](/core-concepts/run-udfs/run-small-udfs/#git-commit-hash-recommended-for-most-stable-use-cases)

### _Nom_ (de votre compte)

_Quand utiliser : Lorsque vous appelez un UDF que vous avez cr√©√©, depuis votre propre compte._

Vous pouvez appeler n'importe quel UDF que vous avez cr√©√© simplement en le r√©f√©rant par son nom (donn√© lorsque vous [enregistrez un UDF](/core-concepts/write/#save-udfs)).

(Note : Cela n√©cessite une authentification)


![Hello World UDF](/img/core-concepts/run-udfs/hello_world_bbox_udf.png)

Cet UDF peut ensuite √™tre ex√©cut√© dans un notebook localement (√† condition que vous vous soyez authentifi√©) :

```python showLineNumbers
fused.run("Hello_World_bbox")
```


![Running Hello World UDF](/img/core-concepts/run-udfs/running_hello_world_bbox_udf.png)

### _Nom_ (du compte de votre co√©quipier)

_Quand utiliser : Lorsque vous appelez un UDF qu'un membre de votre √©quipe a cr√©√©, depuis votre propre compte._

De m√™me, vous pouvez r√©f√©rencer par nom et ex√©cuter n'importe quel UDF sous les comptes de vos co√©quipiers. Il suffit de pr√©fixer le nom de l'UDF avec l'adresse e-mail de la personne, s√©par√©e par un `/`.

```python showLineNumbers
fused.run("teammate@fused.io/Hello_World_bbox")
```

Notez que les comptes de vous et de votre co√©quipier doivent appartenir √† la m√™me organisation.

### _Nom d'UDF public_

_Quand ex√©cuter : Chaque fois que vous souhaitez ex√©cuter un UDF public gratuitement depuis n'importe o√π_

Tout UDF enregistr√© dans le [d√©p√¥t UDF public](https://github.com/fusedio/udfs/tree/main) peut √™tre ex√©cut√© gratuitement.

R√©f√©rez-vous √† eux en pr√©fixant leur nom avec `UDF_`. Par exemple, [l'UDF public `Get_Isochrone`](https://github.com/fusedio/udfs/tree/main/public/Get_Isochrone) est ex√©cut√© avec `UDF_Get_Isochrone` :

```python showLineNumbers
fused.run('UDF_Get_Isochrone')
```

### _Token_

_Quand utiliser : Chaque fois que vous souhaitez que quelqu'un puisse ex√©cuter un UDF mais que vous ne souhaitez pas partager le code avec lui._

Vous pouvez obtenir le token d'un UDF soit dans [Workbench](/workbench/) (Enregistrez votre UDF puis cliquez sur "Partager") ou en retournant le token en Python.

Voici un UDF jouet que nous voulons que d'autres puissent ex√©cuter, mais nous ne voulons pas qu'ils voient le code :

```python showLineNumbers
# Cet exemple provient d'un notebook
import fused

@fused.udf()
def my_super_duper_private_udf(my_udf_input):
    import pandas as pd
    # Ce code est si priv√© que je ne veux pas que quiconque puisse le lire
    return pd.DataFrame({"input": [my_udf_input]})
```

Nous devons ensuite [enregistrer cet UDF sur le serveur Fused](/core-concepts/write/#save-udfs) pour le rendre accessible de n'importe o√π.

```python showLineNumbers
# Cet exemple provient d'un notebook
my_super_duper_private_udf.to_fused()
```

:::note
`my_udf.to_fused()` enregistre votre UDF dans vos UDF utilisateur personnels. Ceux-ci sont priv√©s pour vous et votre √©quipe. Vous pouvez cr√©er un token que quiconque (m√™me en dehors de votre √©quipe) peut utiliser pour ex√©cuter votre UDF, mais par d√©faut, ces UDF sont priv√©s.
:::

Nous pouvons cr√©er un token pour ce `my_super_duper_private_udf` et le partager :

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import LazyReactPlayer from '@site/src/components/LazyReactPlayer'

<Tabs className="unique-tabs">
  <TabItem value="python" label="Python" default>

    ```python showLineNumbers
    token = my_super_duper_private_udf.create_access_token()
    print(token)
    ```

    Cela renverrait quelque chose comme : `'fsh_**********q6X'` (Vous pouvez reconna√Ætre qu'il s'agit d'un token partag√© car il commence par `fsh_`)

  </TabItem>
  <TabItem value="workbench" label="Workbench">

    Vous pouvez cr√©er un token de partage directement depuis Workbench :

    <LazyReactPlayer playsinline={true} className="video__player" playing={true} muted={true} controls height="100%" url="https://fused-magic.s3.us-west-2.amazonaws.com/workbench-walkthrough-videos/docs_rewrite/core-concepts/run-udfs/get_share_token.mp4" width="100%" />

  </TabItem>
</Tabs>

Une fois que vous avez votre token `'fsh_***'`, vous pouvez l'utiliser pour ex√©cuter votre UDF :

```python showLineNumbers
fused.run(token, my_udf_input="J'utilise directement l'objet token")
```

ou directement :

```python showLineNumbers
fused.run('fsh_**********q6X', my_udf_input="Je ne peux pas voir votre UDF priv√© mais je peux toujours l'ex√©cuter")
```

### _Objet UDF_

_Quand ex√©cuter : Lorsque vous √©crivez votre UDF dans le m√™me fichier Python / notebook jupyter et que vous souhaitez vous r√©f√©rer directement √† l'objet Python. Vous pourriez vouloir faire cela pour tester que votre UDF fonctionne localement par exemple_

Vous pouvez √©galement passer un objet UDF Python √† `fused.run` :

```python showLineNumbers
@fused.udf
def local_udf():
    import pandas as pd
    return pd.DataFrame({})

# Notez qu'en passant `engine='local'`, nous ex√©cutons cela comme une fonction Python normale
fused.run(local_udf, engine='local')
```

### _URL Github_

{/* Need to emphasise why this isn't recommended  */}
_Quand utiliser : [Non recommand√©] Cela est utile si vous travaillez sur une branche que vous contr√¥lez. Cette m√©thode pointe toujours vers le dernier commit sur une branche, donc votre UDF peut se casser sans que vous le sachiez si quelqu'un d'autre pousse un nouveau commit ou fusionne et supprime votre branche_

```python showLineNumbers
gh_udf = fused.load("https://github.com/fusedio/udfs/tree/main/public/REM_with_HyRiver/")
fused.run(gh_udf)
```

:::warning
Nous ne recommandons PAS d'utiliser cette approche car votre UDF pourrait se casser si des modifications y sont apport√©es

    En particulier, utiliser une URL pointant vers une branche `main` signifie que votre UDF changera si quelqu'un d'autre y pousse, d'une mani√®re qui n'est pas visible pour vous.

    Pour cette raison, nous recommandons d'utiliser un [hash de commit git](/core-concepts/run-udfs/run-small-udfs/#git-commit-hash-recommended-for-most-stable-use-cases) √† la place

:::

### _Hash de commit git_ (recommand√© pour la plupart des cas d'utilisation stables)

_Quand utiliser : Chaque fois que vous souhaitez vous fier √† un UDF, par exemple en production ou lorsque vous utilisez un UDF comme √©l√©ment constitutif d'un autre UDF._

C'est la mani√®re la plus s√ªre d'utiliser un UDF. Puisque vous pointez vers un hash de commit git sp√©cifique, vous ne finirez pas avec des changements qui cassent votre UDF.

Utiliser un hash de commit git est la mani√®re la plus s√ªre, et donc recommand√©e, d'appeler des UDF depuis Github.

Cela signifie que vous devez mettre √† jour le commit o√π vos UDF sont appel√©s si vous souhaitez propager les mises √† jour. Mais cela vous donne le plus de contr√¥le.

Prenons √† nouveau l'exemple de l'UDF Simple Tour Eiffel :

![Running Hello World UDF](/img/core-concepts/run-udfs/commit_hash_demo.png)

```python showLineNumbers
commit_hash = "bdfb4d0"
commit_udf = fused.load(f"https://github.com/fusedio/udfs/tree/{commit_hash}/public/Single_point_Eiffel_Tower/")
fused.run(commit_udf)
```

### _Noms d'UDF d'√©quipe_

Les UDF d'√©quipe peuvent √™tre charg√©s ou ex√©cut√©s en sp√©cifiant le nom "team", comme dans :

```python showLineNumbers
fused.load("team/udf_name")
```

Cela peut √™tre utile lors de la collaboration avec des membres de l'√©quipe car cela **ne n√©cessite pas** [de cr√©er un token partag√©](/core-concepts/run-udfs/run-small-udfs/#token)

## Moteurs d'ex√©cution

{/* Need more details for this */}

`fused.run` peut ex√©cuter l'UDF dans divers modes d'ex√©cution, comme sp√©cifi√© par le param√®tre `engine`, soit local soit distant

- `local` : Ex√©cuter dans le processus actuel.
- `remote` : Ex√©cuter dans le moteur cloud sans serveur Fused (c'est la valeur par d√©faut).
{/*- `batch` : Ex√©cuter un travail de longue dur√©e dans un serveur Fused. Cela doit d'abord √™tre activ√© pour le compte.*/}

```python showLineNumbers
# Par d√©faut, fused.run utilisera le moteur distant
fused.run(my_udf)
```

```python showLineNumbers
# Pour ex√©cuter localement, sp√©cifiez explicitement engine="local"
fused.run(my_udf, engine="local")
```

:::warning
> ‚ö†Ô∏è **Changement important :** `fused.run()` par d√©faut utilise maintenant `engine="remote"` dans tous les cas, m√™me lorsque les utilisateurs ne sont pas authentifi√©s. Auparavant, il serait par d√©faut `engine="local"` pour les utilisateurs non authentifi√©s.
> Si vous n'√™tes pas authentifi√©, vous devez sp√©cifier explicitement `engine="local"` pour ex√©cuter des UDF localement.
:::

D√©finissez `sync=False` pour ex√©cuter un UDF [de mani√®re asynchrone](/core-concepts/async/).

## Passer des arguments dans [`fused.run()`](/python-sdk/top-level-functions/#fusedrun)

Un appel typique de [`fused.run()`](/python-sdk/top-level-functions/#fusedrun) d'un UDF ressemble √† ceci :

```python showLineNumbers
@fused.udf
def my_udf(inputs: str):
    import pandas as pd
    return pd.DataFrame({"output": [inputs]})

fused.run(my_udf, inputs="hello world")
```

Un appel [`fused.run()`](/python-sdk/top-level-functions/#fusedrun) n√©cessitera les arguments suivants :

1. [Obligatoire] Le premier argument doit √™tre l'UDF √† ex√©cuter (nom, objet, token, etc. [comme vu ci-dessus](/core-concepts/run-udfs/run-small-udfs/#fusedrun))
2. [Optionnel] Tout argument de l'UDF lui-m√™me (s'il en a). Dans l'exemple ci-dessus, c'est `inputs` car `my_udf` prend `inputs` comme argument.
3. [Optionnel] Tout argument prot√©g√© comme vu dans la page d√©di√©e [docs API](/python-sdk/top-level-functions/#fusedrun) (le cas √©ch√©ant). Ceux-ci incluent par exemple :
   - `bounds` -> Une bo√Æte de d√©limitation g√©ographique (sous forme de liste de 4 points : `[min_x, min_y, max_x, max_y]`) d√©finissant la zone d'int√©r√™t.
   - `cache_max_age` -> L'√¢ge maximum [du cache de l'UDF](/core-concepts/cache/#defining-your-cache-lifetime-cache_max_age).

#### Exemples d'utilisation des param√®tres

Changer l'√¢ge maximum du cache par d√©faut :
```python showLineNumbers
fused.run("UDF_CDLs_Tile_Example", cache_max_age='1d')
```

## Ex√©cution de travaux en parall√®le : [`fused.submit()`](/python-sdk/top-level-functions/#fusedsubmit)

Parfois, vous souhaitez ex√©cuter un UDF sur une liste d'entr√©es (par exemple, ex√©cuter un [UDF qui d√©compresse un fichier sur une liste de fichiers](/tutorials/Geospatial%20with%20Fused/use-cases/dark-vessel-detection/#33---run-this-udf-over-a-month-of-ais-data)). Si chaque ex√©cution elle-m√™me est assez petite, alors vous pouvez ex√©cuter un lot d'UDF sur une liste d'entr√©es.

:::warning fused.submit() ne doit pas √™tre ex√©cut√© dans Workbench 
Puisque Workbench peut automatiquement ex√©cuter des UDF √† chaque changement de code, il n'est pas recommand√© d'utiliser `fused.submit()` dans Workbench car cela peut d√©clencher un grand nombre de travaux de multiprocessus. 

Nous recommandons d'utiliser `fused.submit()` dans un notebook ou un script uniquement.
:::

Utilisons un UDF simple pour d√©montrer :

```python showLineNumbers
@fused.udf
def udf(val):
    import pandas as pd
    return pd.DataFrame({'val':[val]})
```

Disons que nous voulions ex√©cuter ce `udf` 10 fois :

```python showLineNumbers
inputs = [0,1,2,3,4,5,6,7,8,9]
```

### [`fused.submit()`](/python-sdk/top-level-functions/#fusedsubmit)

Fused est con√ßu pour vous aider √† √©tendre votre traitement √† d'√©normes ensembles de donn√©es et le c≈ìur de cette capacit√© est [`fused.submit()`](/python-sdk/top-level-functions/#fusedsubmit). Vous pouvez ex√©cuter 1 UDF sur un grand nombre d'arguments :

```python showLineNumbers
# Cet exemple provient d'un notebook, pas de workbench
results = fused.submit(udf, inputs)
```

```bash
>>> 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 10/10 
```

[`fused.submit()`](/python-sdk/top-level-functions/#fusedsubmit) ex√©cute tous ces travaux en parall√®le et par d√©faut renvoie directement les r√©sultats sous forme de dataframe :

```python showLineNumbers
# Cet exemple provient d'un notebook, pas de workbench
results
```

```
>>>
 		val
val
0	0	0
1	0	1
...
```

### Conseils pour utiliser [`fused.submit()`](/python-sdk/top-level-functions/#fusedsubmit)

- V√©rifiez que vos param√®tres sont correctement configur√©s avec `debug_mode=True` (plus de d√©tails [ci-dessous](/core-concepts/run-udfs/run-small-udfs/#debug-mode))

```python showLineNumbers
# Cet exemple provient d'un notebook, pas de workbench
single_run = fused.submit(udf, inputs, debug_mode=True)
```

- Commencez par un petit nombre de travaux, puis augmentez

```python showLineNumbers   
# Cet exemple provient d'un notebook, pas de workbench
# Ex√©cuter uniquement les 5 premi√®res entr√©es pour s'assurer que l'UDF fonctionne comme pr√©vu
results = fused.submit(udf, inputs[:5])
```

- V√©rifiez le temps d'ex√©cution de chaque travail :

```python showLineNumbers
# Cet exemple provient d'un notebook, pas de workbench
# Ex√©cutez uniquement 10 travaux et voyez combien de temps chacun a pris
results = fused.submit(udf, inputs[:5], collect=False)
results.times()
```

:::tip R√®gle g√©n√©rale sur la dur√©e des travaux : 30-45s
Visez un UDF unique qui prend 30-45s. Cela vous donne une marge de "s√©curit√©" car les UDF [expirent apr√®s 120s](/core-concepts/run-udfs/run-small-udfs/#running-udfs). Ainsi, ils peuvent encore prendre un peu plus de temps et ne pas expirer.
:::

- Lisez la page [Meilleures Pratiques](/core-concepts/best-practices/udf-best-practices/#writing-efficient-udfs) pour plus de conseils sur l'√©criture d'UDF efficaces


### Options avanc√©es [`fused.submit()`](/python-sdk/top-level-functions/#fusedsubmit)

#### Appels bloquants vs non bloquants

Par d√©faut, nous avons configur√© [`fused.submit()`](/python-sdk/top-level-functions/#fusedsubmit) pour √™tre bloquant, ce qui signifie qu'il attendra que tous les travaux soient termin√©s avant de renvoyer les r√©sultats.

Cependant, vous pouvez d√©finir `collect=False` et ensuite suivre la progression des travaux au fur et √† mesure qu'ils s'ex√©cutent :

```python showLineNumbers
# Cet exemple provient d'un notebook, pas de workbench
results = fused.submit(udf, inputs, collect=False)
```

#### Journaux en temps r√©el

- Affichez une barre de progression du nombre de travaux termin√©s :

```python showLineNumbers
# Cet exemple provient d'un notebook, pas de workbench
results.wait()
```

```
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 10/10 [00:01<00:00, 9.31it/s]
```

- Affichez le temps total qu'il a fallu pour ex√©cuter tous les travaux :

```python showLineNumbers
# Cet exemple provient d'un notebook, pas de workbench
results.total_time()
```

```
>>> datetime.timedelta(seconds=1, microseconds=96764)
```

- V√©rifiez la premi√®re erreur qui s'est produite :

```python showLineNumbers
# Cet exemple provient d'un notebook, pas de workbench
results.first_error()
```

```
>>> fused.types.UdfRuntimeError("[Run #0 {'val': 3'}] mon message d'erreur ici...")
```


- R√©cup√©rez vos donn√©es sous forme de dataframe :

```python showLineNumbers
# Cet exemple provient d'un notebook, pas de workbench
results.collect()
```

```python showLineNumbers
>>>
 		val
val
0	0	0
1	0	1
...
```

#### Mode d√©bogage

Parfois, vous pourriez simplement vouloir vous assurer que votre code fonctionne correctement avant de lancer un grand nombre de travaux. C'est ce que permet le Mode D√©bogage :

```python showLineNumbers
# Cet exemple provient d'un notebook, pas de workbench
results = fused.submit(udf, inputs, debug_mode=True)
```

Cela ex√©cutera le premier √©l√©ment dans `inputs` directement en utilisant `fused.run()` (√©quivalent √† `fused.run(udf, inputs[0])`) et renverra ensuite les r√©sultats :

```python showLineNumbers
>>>
	val
0	0
```

Vous pouvez ensuite remettre `debug_mode` √† False et √™tre plus confiant que votre UDF fonctionne comme pr√©vu !

#### Param√®tres d'ex√©cution

[`fused.submit()`](/python-sdk/top-level-functions/#fusedsubmit) a √©galement des param√®tres vous donnant plus de contr√¥le sur l'ex√©cution. Consultez la page [docs](/python-sdk/top-level-functions/#fusedsubmit) du SDK Python pour plus de d√©tails :

- `max_workers` : Le nombre de travailleurs √† utiliser pour le pool de travaux.
- `engine` : `local` ou `remote` (la valeur par d√©faut est `remote`).
    Tout comme `fused.run()`, par d√©faut `fused.submit()` ex√©cutera l'UDF dans le serveur Fused (`engine='remote'`). Vous pouvez d√©finir `engine='local'` pour ex√©cuter `udf` localement soit sur votre machine, soit √† l'int√©rieur d'une grande machine que vous d√©marrez.
- `max_retry` : Le nombre maximum de tentatives pour un travail.

 #### √âvaluation des performances

<details>
  <summary>√âvaluation simple [`fused.submit()`](/python-sdk/top-level-functions/#fusedsubmit)</summary>

    `fused.submit(udf)` ex√©cute tous les appels UDF en parall√®le, ce qui en fait un outil utile pour ex√©cuter plusieurs UDF en m√™me temps.

    Nous pouvons d√©montrer cela en ajoutant un simple `time.sleep(1)` dans notre UDF d'origine :
    ```python {4-5} showLineNumbers
    @fused.udf
    def udf(val):
        import pandas as pd
        import time
        time.sleep(1)
        return pd.DataFrame({'val':[val]})
    ```

    Dans un notebook, nous pouvons chronom√©trer combien de temps chaque cellule prend pour s'ex√©cuter avec la commande magique [`%%time`](https://ipython.readthedocs.io/en/stable/interactive/magics.html#magic-time)

    ```python showLineNumbers
    # Dans un notebook jupyter
    %%time
    fused.run(udf, val=1)
    ```

    ![Singe run](/img/core-concepts/run-udfs/fused_run_single_job.png)

    Cela prend 2s : Quelques ms de surcharge pour envoyer l'UDF au serveur Fused et ex√©cuter + 1s de `time.sleep(1)`

    Maintenant, en utilisant `fused.submit()` pour ex√©cuter cela sur 50 UDF :

    ![30 runs](/img/core-concepts/run-udfs/submit_50jobs.png)

    Cela prend quelques secondes de plus, mais pas 100s. `fused.submit()` est une mani√®re utile d'√©tendre un UDF unique √† de nombreuses entr√©es de mani√®re opportune.


</details>

### Temps d'ex√©cution r√©el vs temps CPU

Il existe 2 calculs de temps d'ex√©cution diff√©rents pour les travaux `fused.submit()` :

**Temps d'ex√©cution r√©el** : Temps total r√©el pris pour ex√©cuter les travaux :

```python showLineNumbers
results.total_time()
```

Le calcul exact est :
```python showLineNumbers
round(results.total_time().seconds + results.total_time().microseconds / 10e6, 2)
```

```bash
# Temps total que vous avez d√ª attendre
>>> 11.05
```

**Temps CPU** : Somme de tout le temps CPU pris par les travaux

C'est le temps qui compte pour votre facture.

```python showLineNumbers
round(sum([t.seconds for t in results.times()]) + sum([t.microseconds for t in results.times()]) / 10e6, 2)
```

```bash
# Temps total CPU
>>> 21.78
```


### Exemples de cas d'utilisation

[`fused.submit()`](/python-sdk/top-level-functions/#fusedsubmit) est utilis√© √† de nombreux endroits dans notre documentation, voici quelques exemples :

- üìà Traitement de 20 To de donn√©es en quelques minutes : [Cr√©ation d'un tableau de bord climatique](/tutorials/Geospatial%20with%20Fused/use-cases/Climate%20Dashboard/) de 20 ans de donn√©es
- ‚õ¥Ô∏è [R√©cup√©ration de 30 jours](/tutorials/Geospatial%20with%20Fused/use-cases/dark-vessel-detection/#33---run-this-udf-over-a-month-of-ais-data) de donn√©es de transpondeurs de bateaux AIS autour des √âtats-Unis pour d√©tecter la p√™che ill√©gale
- üõ∞Ô∏è [R√©cup√©ration de tous les catalogues de donn√©es ouvertes STAC de Maxar](/tutorials/Geospatial%20with%20Fused/use-cases/exploring_maxar_data/#preparing-fusedsubmit-to-run-in-parallel) pour chaque √©v√©nement pour lequel ils ont des images.

üí° Consultez la page [Meilleures Pratiques](/core-concepts/best-practices/udf-best-practices/#run-tasks-in-parallel) pour plus d'informations sur quand utiliser `submit()` et quand utiliser d'autres m√©thodes.

## Requ√™tes HTTPS

{/* Need to showcase this in video */}

Vous pouvez appeler des UDF enregistr√©s via des appels HTTPs, transformant efficacement vos donn√©es en une API !

Il en va de m√™me pour le [SDK Python Fused](/python-sdk/).

#### Token partag√©

Lorsque vous enregistrez un UDF pour la premi√®re fois, il cr√©e par d√©faut un token partag√© pour vous, quelque chose comme :

```
fsh_**********h4t
```

C'est un token unique qui est utilis√© pour identifier votre UDF et l'appeler via des requ√™tes HTTPS

Voici √† quoi ressemble un point de terminaison UDF :

```
https://www.fused.io/server/v1/realtime-shared/******/run/file?format=png
```

G√©rez les tokens partag√©s de votre compte [ici](https://www.fused.io/workbench/tokens).

### Passer des param√®tres

Vous pouvez √©galement passer des param√®tres √† votre UDF via l'URL en ajoutant [des param√®tres de requ√™te](https://www.branch.io/glossary/query-parameters/) (`&param=value`) √† l'URL.

Par exemple, un UDF qui prend `lat` et `lon` comme param√®tres :

```python showLineNumbers
@fused.udf
def udf(lat, lon):
    return pd.DataFrame({'lat': [lat], 'lon': [lon]})
```

Pourrait √™tre appel√© avec :

```
https://www.fused.io/...&lat=37.7749&lon=-121.4194
```

### Tuilage 

Vous pouvez int√©grer votre UDF en tant que serveur de tuiles vectorielles ou raster en ajoutant le param√®tre de chemin `tiles`, suivi des param√®tres de chemin templ√©s `/{z}/{x}/{y}`.

Vous devez vous assurer que :
- Votre UDF est r√©gl√© sur [mode Tile](/tutorials/Geospatial%20with%20Fused/filetile/#tile)
- Vous passez correctement `/{z}/{x}/{y}` au lieu de la valeur par d√©faut
- En fonction de votre type de serveur, vous pourriez avoir besoin d'ajouter le param√®tre `format`. Par exemple, [QGIS](/tutorials/Geospatial%20with%20Fused/other-integrations/#qgis) exige que vous utilisiez `format=mvt` pour [les serveurs de tuiles vectorielles](/tutorials/Geospatial%20with%20Fused/other-integrations/#vector-tiles-1)

```
https://www.fused.io/server/v1/realtime-shared/******/run/tiles/{z}/{x}/{y}?format=png
```

Consultez nos [guides d'int√©gration](/tutorials/Geospatial%20with%20Fused/other-integrations/) pour des exemples.

### Token priv√©

Appeler des UDF avec [l'authentification Bearer](https://swagger.io/docs/specification/authentication/bearer-authentication/) n√©cessite un [token priv√© du compte](/python-sdk/authentication/#get-bearer-access-token). La structure de l'URL pour ex√©cuter des UDF avec le token priv√© varie l√©g√®rement, car l'URL sp√©cifie le nom de l'UDF et le compte utilisateur du propri√©taire.

```bash
curl -XGET "https://app.fused.io/server/v1/realtime/fused/api/v1/run/udf/saved/user@fused.io/caltrain_live_location?format=png" -H "Authorization: Bearer $ACCESS_TOKEN"
```

:::warning Ne partagez pas votre token Bearer

Ne partagez pas votre token Bearer avec qui que ce soit. Ceux-ci permettent d'usurper votre compte et doivent √™tre trait√©s comme tels.

:::

### Format de s√©rialisation

Le param√®tre `format` d√©finit le type de donn√©es de sortie pour le r√©sultat s√©rialis√© de l'UDF.

- Les types pris en charge pour les tables vectorielles sont `parquet`, [`geojson`](/tutorials/Geospatial%20with%20Fused/other-integrations/#deckgl), [`json`](/tutorials/Geospatial%20with%20Fused/other-integrations/#deckgl), `feather`, `csv`, [`mvt`](/tutorials/Geospatial%20with%20Fused/other-integrations/#mapbox), `html`, `excel`, et `xml`.
- Pour le tableau raster : [`png`](/tutorials/Geospatial%20with%20Fused/other-integrations/#deckgl), `gif`, `jpg`, `jpeg`, `webp`, `tif`, et `tiff`.
- Pour des objets Python simples comme des cha√Ænes : `json`, `html`

```
https://www.fused.io/server/v1/realtime-shared/****/run/file?format=png
```

Lisez comment structurer les points de terminaison HTTPS pour appeler l'UDF en tant que [carte de tuiles & fichier](/tutorials/Geospatial%20with%20Fused/filetile/#tile-https-call).


### Appeler des UDF sans SDK Python 

Vous pouvez √©galement ex√©cuter un UDF entier directement dans la requ√™te HTTP sans avoir besoin de Python lors de l'appel

Vous devez d'abord r√©cup√©rer votre [token bearer](/python-sdk/authentication/#get-bearer-access-token) (cela n√©cessite Python) :
```python showLineNumbers
# D√©terminez votre token bearer :
from fused._auth import AUTHORIZATION
AUTHORIZATION.credentials.access_token
```

Cela renvoie quelque chose comme :
```bash
'eyJ4K9pL2Mx...'
```

Ensuite, nous devons faire une requ√™te POST vers le point de terminaison du serveur Fused : `'https://www.fused.io/server/v1/realtime/basic-tier/api/v1/run/udf'`

Vous aurez besoin de l'identifiant client :

**Sans environnement (Niveau de base)**

Utilisez simplement `basic-tier` comme nom de votre identifiant client.

**Avec environnement**

1. Dans [Workbench](/workbench/), allez dans "Pr√©f√©rences"
2. Notez le nom "Kernel" que vous voyez affich√©, dans ce cas `fused` :

![Finding your kernel name in Workbench](/img/core-concepts/run-udfs/kernel_name_from_workbench.png)

Voici un exemple d'appel avec un simple UDF "Hello World" utilisant le compte `basic-tier` :

```bash
curl -X 'POST' \
  'https://www.fused.io/server/v1/realtime/basic-tier/api/v1/run/udf' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer <BEARER_TOKEN_GOES_HERE>' \
  -H 'Content-Type: application/json' \
  -d '{"step_config":"{\"type\":\"udf\",\"udf\":{\"type\":\"geopandas_v2\",\"name\":\"azure_lion\",\"entrypoint\":\"udf\",\"parameters\":{},\"metadata\":{\"fused:udfType\":\"auto\",\"fused:slug\":\"azure_lion\",\"fused:name\":\"azure_lion\"},\"code\":\"@fused.udf\\ndef udf(name: str = \\\"world\\\"):\\n    import pandas as pd\\n\\n    return pd.DataFrame({\\\"hello\\\": [name]})\\n\",\"headers\":[]}}","dtype_in":"json","format":"geojson,png","cache":true}'
```

Cela :
- Ex√©cute le UDF suivant directement en le passant par la requ√™te HTTP :
```python showLineNumbers
@fused.udf
def udf(name: str = "world"):
    import pandas as pd
    return pd.DataFrame({"hello": [name]})
```
- Sur le compte `basic-tier` (ou quel que soit le compte que vous utilisez)
Si vous utilisez un compte abonn√©, vous devrez ajuster `basic-tier` pour s'adapter √† votre environnement :

```bash
https://www.fused.io/server/v1/realtime/<your-client-id>/api/v1/run/udf
```

## Mise en cache des r√©ponses

Si le [cache](/core-concepts/cache/) d'un UDF est activ√©, ses points de terminaison mettent en cache les sorties pour chaque combinaison de code et de param√®tres. Le premier appel ex√©cute et met en cache l'UDF, et les appels suivants renvoient des donn√©es mises en cache.